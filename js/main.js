function setSetSel(a,b){if(current_datsel=gdata[b],void 0===current_datsel.props&&$.getJSON(DATA_DIR+current_datsel.properties,function(a){current_datsel.props=a,console.log('~~ Member properties of "'+current_datsel.id+'" have been loaded')}),void 0!==current_datsel.datasets[a].data)current_setsel=current_datsel.datasets[a],updateUI(),genChart(),genGrid();else{var c=0,d=setInterval(function(){var a=["loading... &nbsp; &nbsp; ┬──┬","loading... &nbsp; &nbsp; ┬──┬","loading... (°o°） ┬──┬","loading... &nbsp;(°o°）┬──┬","loading... (╯°□°）╯ ┻━┻","loading... (╯°□°）╯︵ ┻━┻","loading... (╯°□°）╯︵ ︵ ┻━┻","loading... (╯°□°）╯︵ ︵ ︵ ┻━┻","loading... ︵ ︵ ︵ ┻━┻","loading... ︵ ︵ ┻━┻","loading... ︵ ┻━┻","loading... &nbsp; &nbsp; ┻━┻ &nbsp; &nbsp; (ツ)","loading... &nbsp; &nbsp; ┻━┻ &nbsp; &nbsp;(ツ)","loading... &nbsp; &nbsp; ┻━┻ &nbsp; (ツ)","loading... &nbsp; &nbsp; ┻━┻ &nbsp;(ツ)","loading... &nbsp; &nbsp; ┬──┬ ¯\\_(ツ)","loading... &nbsp; &nbsp; ┬──┬ (ツ)"];$("#legend").html(a[c]),c=(c+1)%17},180),e=new Date;console.log("~~ starting to load dataset "+current_datsel.datasets[a].strings.label+" ~~ "),$.getJSON(DATA_DIR+current_datsel.datasets[a].file,function(b){console.log(" |BM| finished loading "+current_datsel.datasets[a].strings.label+" data (took "+(new Date-e)+"ms)"),current_datsel.datasets[a].data=b,current_setsel=current_datsel.datasets[a],e=Date.now(),preprocess(current_setsel),console.log(" |BM| finished preprocessing object iterators ("+(Date.now()-e)+"ms)"),clearInterval(d),updateUI(),genChart(),initComplete=!0,genGrid()})}}function preprocess(a){if(a.ready===!0)return!1;void 0===a.itarraytor&&(a.itarraytor=[]);for(var b=(C_WMAX-C_WMIN)/a.parent.tile_width;b--;)if(void 0===a.itarraytor[b]){a.itarraytor[b]=[];for(var c in a.data[b])a.itarraytor[b].push(parseInt(c))}a.ready=!0}function onResize(){viewportW=$(window).width(),viewportH=$(window).height(),canvasW=Math.floor($("#map").width()),canvasH=Math.floor($("#map").height()),overcan.attr("width",canvasW).attr("height",canvasH),$("#leaflet").css("width",canvasW).css("height",canvasH),initLeaflet(),genGrid(),genChart()}function genGrid(a,b,c){return void 0===chart?0:(clearTimeout(redrawTimer),void(redrawTimer=setTimeout(function(){generateGrid(a,b,c)},CALC_TIMEOUT)))}function generateGrid(a,b,c){if(!allow_redraw)return!1;void 0===c&&(c=current_setsel),void 0===b&&(b=getBounds(!0)),void 0===a&&(a=calcReso());var d=function(){console.log("/~~ generating new grid with resolution "+a+" ~~\\");var d=new Date;console.log("  ~ start iterating data");var e=0;cellmap={},setColorScale(a);var f=getTimeSelection(),g=getMinMaxTile(b),h=g.min,i=g.max;console.log("  # will iterate over tiles "+h+" to "+i),renderRTL=lastMapCenter.lng>(lastMapCenter=leafly.getCenter()).lng;var j=function(){console.log("  |BM| iteration complete ("+(new Date-d)+"ms)"),calcPlotDat(cellmap,a),console.log("  |BM| finished genGrid (total of "+(new Date-d)+"ms)");var b=c.strings.term||L_DEFAULT_TERM;$("#legend").html("<em>inside the visible area</em><br>we have registered a total of<br><em>"+e+" "+c.strings.label+"</em><br>"+b.replace("%l","<em>"+f.min+"</em>").replace("%h","<em>"+f.max+"</em>")),selectCell(),console.log("\\~~ grid generation complete~~/ "),mutexGenGrid=0,leaflaggrid._redraw()},k=function(d){if(-1===mutexGenGrid)return mutexGenGrid=0,0;var g,l,m,n,o,p,q={};if(m=renderRTL?i-d:h+d,i>=m&&m>=h){for(p=c.itarraytor[m].length;p--;)if(n=c.itarraytor[m][p],n>=f.min&&n<=f.max)for(o=c.data[m][n].length;o--;)g=c.data[m][n][o],section_filter(g,b)&&(l=coord2index(g[ARR_M_LON],g[ARR_M_LAT],a),void 0===cellmap[l]&&(cellmap[l]=[]),cellmap[l].push([g[ARR_M_I],n]),q[l]=cellmap[l],e++);calcPlotDat(q,a,m),leaflaggrid._redraw(),setTimeout(function(){k(++d)},1)}else j()};k(0)};1===mutexGenGrid&&(mutexGenGrid=-1);var e=function(){0!==mutexGenGrid?setTimeout(e,10):(mutexGenGrid=1,$("#legend").html("<em>massive calculations...</em>"),setTimeout(d,1))};e()}function section_filter(a,b){return a[ARR_M_LAT]>=b[1].min&&a[ARR_M_LAT]<=b[1].max&&a[ARR_M_LON]>=b[0].min&&a[ARR_M_LON]<=b[0].max}function calcPlotDat(a,b,c){void 0!==a&&void 0===b&&conslole.warn("drawPlot(): newmap given but no resolution. Using old drawing data.");var d=Date.now();if(void 0!==a&&void 0!==b){var e=[],f=1/0,g=-1/0;$.each(a,function(a,c){var d=index2canvasCoord(a,b);c=c.length,e.push([d,c]),f>c&&(f=c),c>g&&(g=c)}),drawdat={draw:e,min:f,max:g,reso:b}}drawdat.tile=c,void 0===c&&(console.log("  ~ drawing "+drawdat.draw.length+" shapes"),console.log("  # data extreme values - min: "+drawdat.min+", max: "+drawdat.max),console.log("  |BM| (dataset generation in "+(new Date-d)+"ms)"))}function drawPlot(a,b){if(void 0===drawdat.draw)return!1;var c=Date.now(),d=b.canvas.getContext("2d"),e=$(b.canvas).css("transform");e=e.split(",");var f=[parseInt(e[e.length-2]),parseInt(e[e.length-1])],g=f[0]-lastAgPos[0],h=f[1]-lastAgPos[1],i=parseFloat($("#bleed-slider").val()),j=drawdat.reso*i,k=j/2,l=drawdat.reso/2;drawdat.wx=j,drawdat.rx=k,drawdat.rr=l,d.save(),void 0===drawdat.tile?d.clearRect(0,0,b.canvas.width,b.canvas.height):"number"==typeof drawdat.tile&&clearTile(drawdat.tile);var m=1-.15*(i-1);m>1&&(m=1),d.globalAlpha=m;for(var n,o,p,q=drawdat.draw.length;q--;)n=drawdat.draw[q],o=n[0].x-g+l,p=n[0].y-h+l,d.fillStyle=colorScale(n[1]),d.beginPath(),d.arc(o,p,k,0,TPI),d.fill();void 0===drawdat.tile&&console.log("  |BM| canvas rendering of "+drawdat.draw.length+" shapes took "+(Date.now()-c)+"ms"),d.globalAlpha=1,d.restore(),lastAgPos=f}function highlightCell(a){var b,c,d,e=2,f=drawdat.wx,g=drawdat.rx,h=drawdat.rr;if(overctx.save(),overctx.clearRect(0,0,canvasW,canvasH),selectedCell!==!1&&(d=index2canvasCoord(selectedCell,drawdat.reso),b=d.x+h,c=d.y+h,overctx.fillStyle="rgba(255,120,0,0.8)",overctx.beginPath(),overctx.arc(b,c,g,0,TPI),overctx.fill(),overctx.strokeStyle="rgba(255,255,255,0.4)",overctx.lineWidth=3*e,overctx.beginPath(),overctx.arc(b,c,1.5*g,0,TPI),overctx.stroke(),overctx.strokeStyle="rgba(0,0,0,0.5)",overctx.lineWidth=1*e,overctx.beginPath(),overctx.arc(b,c,1.5*g,0,TPI),overctx.stroke()),a===!1)return overctx.restore(),!1;d=index2canvasCoord(a,drawdat.reso),b=d.x+h,c=d.y+h;var i=overctx.createRadialGradient(b,c,0,b,c,2*f);i.addColorStop(0,"rgba(255,255,255,0"),i.addColorStop(.25,"rgba(255,255,255,0.5"),i.addColorStop(1,"rgba(255,255,255,0"),overctx.fillStyle=i,overctx.beginPath(),overctx.arc(b,c,4*g,0,TPI),overctx.fill(),overctx.fillStyle="rgba(255,244,10,0.9)",overctx.beginPath(),overctx.arc(b,c,g,0,TPI),overctx.fill(),overctx.restore()}function highlightCellsFor(a){var b=current_setsel.data,c=drawdat.reso,d=drawdat.rx,e=drawdat.rr;drawWhat();var f,g,h,i,j=drawdat.bounds,k=drawdat.mmt,l={},m=[];for(f=k.min;f<=k.max;f++)if(void 0!==(g=b[f][a]))for(h=g.length;h--;)section_filter(g[h],j)&&(i=coord2index(g[h][ARR_M_LON],g[h][ARR_M_LAT],c),l[i]=!0);$.each(l,function(a){m.push(a)}),overctx.save(),overctx.clearRect(0,0,canvasW,canvasH),overctx.fillStyle="rgba(255,255,255,0.7)",overctx.strokeStyle="rgba(0,0,0,1)",overctx.lineWidth=d/2;var n,o,p;for(f=m.length;f--;)p=index2canvasCoord(m[f],c),n=p.x+e,o=p.y+e,overctx.beginPath(),overctx.arc(n,o,d,0,TPI),overctx.fill(),overctx.stroke();overctx.restore()}function initLeaflet(){return void 0!==leafly?(leafly.invalidateSize(),!1):(leafly=L.map("leaflet",{attributionControl:!1,worldCopyJump:!0}).setView([0,0],2),leafly.___eventHandlersAtached=!1,leafloor=L.tileLayer("",{subdomains:["a","b","c","d"],minZoom:M_ZOOM_RANGE[0],maxZoom:M_ZOOM_RANGE[1]}),leafloor.addTo(leafly),L.control.attribution({prefix:!1}).addAttribution('<a id="home-link" target="_top" href="http://maps.stamen.com/">Map tiles</a> by <a target="_top" href="http://stamen.com">Stamen Design</a>, under <a target="_top" href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a target="_top" href="http://openstreetmap.org">OpenStreetMap</a>, under <a target="_top" href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.').addTo(leafly),leaflaggrid=L.canvasOverlay(),void leaflaggrid.drawing(drawPlot).addTo(leafly))}function attachMapHandlers(){return leafly.___eventHandlersAtached===!0?(console.warn("attachMapHandlers() has been called again."),!1):(leafly.on("movestart",function(){selectCell(!1)}).on("moveend",function(){genGrid(),genChart()}).on("zoomend",function(){drawdat.draw=void 0,clearGrid()}).on("mousemove",function(a){canvasMouseMove(a)}).on("click",function(a){canvasMouseClick(a)}),void(leafly.___eventHandlersAtached=!0))}function changeTileSrc(){if(void 0===leafloor)return!1;var a,b="http://{s}.sm.mapstack.stamen.com/",c="/{z}/{x}/{y}.png",d="(";$("#ctrl-maplayer input[type=checkbox]").each(function(){this.checked&&("("!==d&&(d+=","),d+=$(this).attr("data-str"))}),a="("===d?"":b+d+")"+c,leafloor.setUrl(a)}function calcReso(){return canvasW/M_BASE_GRIDROWS*resoFactor}function drawWhat(){void 0===drawdat.bounds&&(drawdat.bounds=getBounds(!0)),void 0===drawdat.mmt&&(drawdat.mmt=getMinMaxTile(drawdat.bounds))}function getBounds(a){var b=leafly.getBounds(),c=[{min:b._southWest.lng,max:b._northEast.lng},{min:b._southWest.lat,max:b._northEast.lat}];return a===!0&&(c[0].min<C_WMIN&&(c[0].min=C_WMIN),c[0].min>C_WMAX&&(c[0].min=C_WMAX),c[0].max<C_WMIN&&(c[0].max=C_WMIN),c[0].max>C_WMAX&&(c[0].max=C_WMAX),c[1].min<C_HMIN&&(c[1].min=C_HMIN),c[1].min>C_HMAX&&(c[1].min=C_HMAX),c[1].max<C_HMIN&&(c[1].max=C_HMIN),c[1].max>C_HMAX&&(c[1].max=C_HMAX)),c}function getMinMaxTile(a){void 0===a&&(a=getBounds(!0));for(var b=0;a[0].min>C_WMIN+(b+1)*current_datsel.tile_width;)b++;for(var c=b;a[0].max>C_WMIN+(c+1)*current_datsel.tile_width;)c++;return{min:b,max:c}}function coord2index(a,b,c){var d=leafly.latLngToContainerPoint(L.latLng(b,a));return Math.floor(d.y/c)*(canvasW/c)+Math.floor(d.x/c)}function canvasCoord2index(a,b){return Math.floor(a.y/b)*(canvasW/b)+Math.floor(a.x/b)}function index2geoCoord(a,b){var c=index2canvasCoord(a,b),d=leafly.containerPointToLatLng([c.x,c.y]);return[d.lat,d.lng]}function index2canvasCoord(a,b){var c=canvasW/b;return{x:a%c*b,y:Math.floor(a/c)*b}}function clearGrid(){var a=leaflaggrid._canvas.getContext("2d");a.clearRect(0,0,canvasW,canvasH)}function clearTile(a){var b=leaflaggrid._canvas.getContext("2d"),c=getBounds(),d=L.latLng(c[1].max,current_datsel.tile_width*a),e=L.latLng(c[1].min,current_datsel.tile_width*(a+1));d=leafly.latLngToContainerPoint(d),e=leafly.latLngToContainerPoint(e),b.clearRect(d.x,d.y,e.x-d.x,d.y-e.y)}function currentCursorPos(a){var b=a.containerPoint;return{x:b.x-M_HOVER_OFFSET.l,y:b.y-M_HOVER_OFFSET.t}}function canvasMouseMove(a){if(0!==mutexGenGrid)return!1;var b=currentCursorPos(a),c=canvasCoord2index(b,drawdat.reso),d=cellmap[c];if(highlightCell(c),void 0!==d){var e=index2geoCoord(c,drawdat.reso),f=(e[0]+drawdat.reso/2).toFixed(2),g=(e[1]+drawdat.reso/2).toFixed(2);clearTimeout(bubbleTimer),bubbleTimer=!0,$bubble.css("opacity","1").css("bottom",viewportH-a.originalEvent.pageY+M_BUBBLE_OFFSET+"px").css("right",viewportW-a.originalEvent.pageX+M_BUBBLE_OFFSET+"px").html(d.length+" <em>"+current_setsel.strings.label+"</em><br><span>["+f+", "+g+"]</span>")}else bubbleTimer===!0&&(bubbleTimer=setTimeout(function(){$bubble.css("opacity","0")},250))}function canvasMouseClick(a){if(0!==mutexGenGrid)return!1;var b=currentCursorPos(a),c=canvasCoord2index(b,drawdat.reso);selectCell(c)}function selectCell(a){if(void 0===drawdat.draw)return!1;void 0===a&&(a=selectedCell);var b=$("#infolist"),c=$("#cellinfo-desc>div");if(b.html(""),a===!1)return c.hide(),selectedCell=!1,highlightCell(!1),urlifyState(),!0;var d=cellmap[a];if(void 0===d)selectCell(!1);else{selectedCell=a,c.show();var e=0;d.length>100&&(c.html("<em>assembling list...</em>"),e=5),setTimeout(function(){var e=index2geoCoord(a),f=(e[0]+drawdat.reso/2).toFixed(2),g=(e[1]+drawdat.reso/2).toFixed(2);highlightCell(a,!0),b.html(""),$.each(d,function(){var a=current_datsel.props.members[this[0]];b.append('<tr><td><a class="q" href="https://www.wikidata.org/wiki/'+a+'" data-qid="'+a+'" target="wikidata">'+a+"</a></td><td>"+this[1]+"</td></tr>")}),c.html("the <em>selected cell</em> <span>around ("+f+", "+g+")</span> contains <em>"+d.length+"</em> of them:"),b.trigger("scroll")},e),urlifyState()}}function infolistScroll(){clearTimeout(infolistTimer),infolistTimer=setTimeout(infolistScrollFkt,CALC_TIMEOUT)}function infolistScrollFkt(){var a=$("#cellinfo"),b=$("#infolist"),c=a.position().top+b.position().top,d=c+b.height(),e=[],f=$("#langsel").val();b.find("a.q").each(function(){var a=this.getBoundingClientRect().top;a>=c&&d>=a&&e.push(this)});for(var g=function(a){$.each(a.entities,function(){var a=this.id;void 0!==this.labels&&void 0!==this.labels[f]&&void 0!==this.labels[f].value&&(a=this.labels[f].value),$(e).filter('[href$="'+this.id+'"]').removeClass("q").text(a)})},h=0,i=20,j="https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&ids=",k="&props=labels&languages="+f+"&languagefallback=&callback=?",l=-1,m=j;++l<e.length;)h>0&&(m+="|"),m+=$(e[l]).attr("data-qid"),(++h>=i||l+1===e.length)&&(m+=k,$.getJSON(m,g),m=j,h=0)}function setColorScale(a){void 0===a&&(a=calcReso());for(var b=15e3*a,c=M_COLOR_SCALE.length-1,d=[1],e=Math.log(b),f=1;c>=f;f++)d.push(Math.floor(Math.pow(Math.E,e/c*f)));colorScale.domain(d)}function genChart(a){if(current_setsel.ready!==!0)return!1;var b=new Date;updateChartDataFkt(a),initChart(),console.log("  |BM| chart creation complete (total of "+(new Date-b)+"ms)"),console.log("\\~~ finished generating chart ~~/ ")}function updateChartDataFkt(a){void 0===a&&(a=current_setsel),console.log("/~~ generating chart data ~~\\ ");var b=Date.now();drawWhat();var c=drawdat.bounds,d=drawdat.mmt;chartdat=[];var e,f,g,h,i,j,k,l={},m={},n=function(a){var b=[],c=[],d=[];for(e in a)d.push(parseInt(e));for(d.sort(function(a,b){return a-b}),g=d.length,e=0;g>e;e++)b.push(d[e]),c.push(a[d[e]]);chartdat.push([b,c])};if(timelineIsGlobal){var o=(C_WMAX-C_WMIN)/a.parent.tile_width;for(e=0;o>e;e++)for(k=a.itarraytor[e].length,j=-1;++j<k;)if(f=a.itarraytor[e][j],i=a.data[e][f],g=i.length,void 0===l[f]?l[f]=i.length:l[f]+=i.length,void 0===m[f]&&(m[f]=0),e>=d.min&&e<=d.max)for(h=0;g>h;h++)i=a.data[e][f][h],section_filter(i,c)&&m[f]++;n(l),n(m)}else{for(e=d.min;e<=d.max;e++)for(j=a.itarraytor[e].length;j--;)for(f=a.itarraytor[e][j],g=a.data[e][f].length,void 0===m[f]&&(m[f]=0),h=0;g>h;h++)i=a.data[e][f][h],section_filter(i,c)&&m[f]++;n(m)}console.log("  |BM| timeline data updated in "+(Date.now()-b)+"ms")}function initChart(){if(chartdat.length<=0)return!1;void 0!==chart&&chart.destroy();var a,b,c,d,e,f=10,g=$("#chart"),h=g.width(),i=Math.floor(g.height()*(2/3))-f,j=Math.floor(g.height()*(1/3)),k=function(){var a=getTimeSelection();(timeSel.data.x.min!==a.min||timeSel.data.x.max!==a.max)&&(timeSel.data.x={min:a.min,max:a.max},genGrid()),$("#range-tt-min>div").text(a.min),$("#range-tt-max>div").text(a.max)};b={name:"detail",data:chartdat,height:i,width:h,title:"Timeline",config:{colors:timelineIsGlobal?["#00A8F0","#C0D800"]:["#A0D345"],bars:{lineWidth:1,show:!0,fill:!0,fillOpacity:.6},mouse:{track:!0,trackY:!1,trackAll:!0,sensibility:1,trackDecimals:4,position:"nw",lineColor:"#ff9900",fillColor:"#ff9900",fillOpacity:.6,trackFormatter:function(){var a=current_setsel.strings.timelineToolTip||T_DEFAULT_TOOLTIP;a=a.match(/(.*)(\%.)(.*)(\%.)(.*)(\%.)(.*)/);for(var b='var k = parseInt(o.x);highlightCellsFor(k);return "',c=1;c<a.length;c++)b+="%l"===a[c]?"<em>"+current_setsel.strings.label+"</em> ":"%x"===a[c]?'" + k + " ':"%v"===a[c]?'<em>" + parseInt(o.y) + "</em> ':a[c];return b+=" <span>(",timelineIsGlobal&&(b+='<em>"+chart.components[0].options.config.data[1][o.index][1]+"</em> '),b+='in map area)</span>";',Function("o",b)}()},yaxis:{autoscale:!0,autoscaleMargin:.05,noTicks:4,showLabels:!0,min:0}}},c={name:"summary",data:chartdat,height:j,width:h,config:{lines:{show:!0,lineWidth:1,fill:!0,fillOpacity:.2,fillBorder:!0},xaxis:{noTicks:5,showLabels:!0},yaxis:{autoscale:!0,autoscaleMargin:.1},handles:{show:!0},selection:{mode:"x"}}},e={name:"connection",adapterConstructor:envision.components.QuadraticDrawing,height:f,width:h},chart=new envision.Visualization,a=new envision.Component(b),summary=new envision.Component(c),d=new envision.Component(e),interaction=new envision.Interaction,chart.add(a).add(d).add(summary).render(g.get(0)),interaction.leader(summary).follower(a).follower(d).add(envision.actions.selection,{callback:k}),appendTimelineRangeTips(),appendListeners(),summary.trigger("select",timeSel)}function changeTimeSel(a,b,c){void 0===c&&(c=!0);var d=chart.components[2].api.flotr.selection;return c&&(timeSel.fmin+=a-Math.floor(a),timeSel.fmax+=b-Math.floor(b),a=Math.floor(a+timeSel.data.x.min+Math.floor(timeSel.fmin)),b=Math.floor(b+timeSel.data.x.max+Math.floor(timeSel.fmax)),timeSel.fmin-=Math.floor(timeSel.fmin),timeSel.fmax-=Math.floor(timeSel.fmax)),a>=b?!1:b>current_setsel.max?!1:a<current_setsel.min?!1:(timeSel.data.x={min:a,max:b},(a!==current_setsel.min||b!==current_setsel.max)&&(d.selecting=!0),void d.setSelection({x1:a,x2:b}))}function getTimeSelection(){var a,b=current_setsel.min,c=current_setsel.max,d=chart.components[2].api.flotr.selection;return d.selecting!==!1?(a=d.getArea(),a.min=Math.round(a.x1),a.max=Math.round(a.x2)):a={min:b,max:c},{min:a.min>=b?a.min:b,max:a.max<=c?a.max:c}}function appendListeners(){$(chart.components[0].node).on("mouseleave",function(){highlightCell(!1)})}function appendTimelineRangeTips(){var a=$('<div id="range-tt-min" class="range-tt hover-tt"><span class="arrow arrow-left"></span><div></div><span class="arrow arrow-right"></span></div><div id="range-tt-max" class="range-tt hover-tt"><span class="arrow arrow-left"></span><div></div><span class="arrow arrow-right"></span></div>');$("#chart").append(a);var b,c;$(".range-tt .arrow").on("mousedown",function(){var a="range-tt-min"===$(this).parent().attr("id")?$(this).hasClass("arrow-left")?-1:1:0,d="range-tt-max"===$(this).parent().attr("id")?$(this).hasClass("arrow-left")?-1:1:0;changeTimeSel(a,d),b=setTimeout(function(){c=setInterval(function(){changeTimeSel(a,d)},100)},100)}).on("mouseup",function(){clearTimeout(b),clearInterval(c)});var d,e=d3.behavior.drag().on("drag",function(){changeTimeSel(-d3.event.dx*d,-d3.event.dx*d)}).on("dragstart",function(){d=(timeSel.data.x.max-timeSel.data.x.min)/$("#chart").width()});d3.selectAll("#chart .detail").call(e)}function setupControlHandlers(){for(var a=function(){setSetSel(this.value,$(this).parent().parent().attr("data-gi"))},b=$("#filter"),c=0;c<gdata.length;c++){var d=$("<fieldset>").attr("data-gid",gdata[c].id).attr("data-gi",c);d.append("<legend>"+gdata[c].title+"</legend>");for(var e=0;e<gdata[c].datasets.length;e++){var f=$('<input type="radio" name="radio" value="'+e+'" />').on("change",a);d.append($('<label class="tooltip" data-tt="'+gdata[c].datasets[e].strings.desc+'">'+gdata[c].datasets[e].strings.label+"</label>").prepend(f))}b.append(d)}$(".controls input[type='range']").on("input",function(){$(this).siblings("input[type='text']").val(parseFloat($(this).val()).toFixed(1))}),$("#reso-slider").on("change",function(){resoFactor=parseFloat($(this).val()),genGrid()}),$("#bleed-slider").on("change",function(){leaflaggrid._redraw(),urlifyState()}),$("#map-opacity").on("input",function(){$(leafloor._container).css("opacity",$(this).val()),urlifyState()}),$("#ctrl-maplayer input[type=checkbox]").on("change",function(){changeTileSrc(),urlifyState()}),$("#ctrl-tlmode input").on("change",function(){timelineIsGlobal=parseInt($(this).val()),genChart(),urlifyState()}),$("#sidebar>menu h2").on("click",function(){$(this).toggleClass("closed"),$(this).siblings("fieldset").slideToggle()}),$("#infolist").on("scroll",infolistScroll),$("#map").on("mouseleave",function(){$bubble.css("opacity","0")}),$(window).resize(function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(onResize,400)});var g=langCodes;for(c=0;c<g.length;c++)$("#langsel").append($('<option value="'+g[c]+'">'+g[c]+"</option>"));$("#langsel").on("change",function(){$("#infolist a").addClass("q"),$("#infolist").trigger("scroll"),urlifyState()})}function updateUI(){var a=current_setsel.strings.zprop||T_DEFAULT_ZPROP;$("#cellinfo th:last-child").text(a)}function urlifyState(){if(!initComplete)return!1;var a=$("#filter input[type='radio']:checked").val(),b="d="+a;b+="&m="+current_datsel.id,b+="&l="+$("#langsel").val(),b+="&f="+timelineIsGlobal;var c=getTimeSelection();b+="&e="+c.min+"_"+c.max,b+="&c="+selectedCell,b+="&g="+resoFactor,b+="&h="+$("#bleed-slider").val(),b+="&o="+$("#map-opacity").val();var d=0;$("#maplayer-labels").get(0).checked&&(d+=1),$("#maplayer-shape").get(0).checked&&(d+=2),b+="&p="+d;var e=leafly.getCenter();b+="&x="+e.lng+"&y="+e.lat,b+="&z="+leafly.getZoom(),window.location.hash=b}function statifyUrl(){mutexStatify=1;var a,b=window.location.hash,c=DEFAULT_LABELLANG,d=DEFAULT_DATAGROUP,e=DEFAULT_DATASET,f=timelineIsGlobal,g=M_DEFAULT_TILE_OPACITY,h=M_DEFAULT_TILE_CONF,i=0,j=0,k=2;b=b.substring(1).split("&");for(var l=0;l<b.length;++l){var m=b[l].substring(0,1),n=b[l].substring(2);switch(m){case"d":e=parseInt(n);break;case"l":c=n;break;case"f":f=n;break;case"m":d=n;break;case"e":var o=n.split("_");a={min:parseInt(o[0]),max:parseInt(o[1])};break;case"g":$("#reso-slider").val(parseFloat(n)).trigger("input").trigger("change");break;case"h":$("#bleed-slider").val(parseFloat(n)).trigger("input");break;case"o":g=parseFloat(n);break;case"p":h=parseInt(n);break;case"x":i=parseFloat(n);break;case"y":j=parseFloat(n);break;case"z":k=parseInt(n);break;case"c":selectedCell=parseFloat(n);break;default:console.warn("statifyUrl(): discarded unrecognized parameter '"+m+"' in url pattern")}}for(var p=gdata.length;--p&&gdata[p].id!==d;);gdata[p].id!==d&&(console.warn('cannot find datagroup "'+d+'". Falling back to "'+gdata[p].id+'"'),d=gdata[p].id),void 0===a&&(a={min:gdata[p].datasets[e].options.initSelection.min,max:gdata[p].datasets[e].options.initSelection.max}),$("#langsel").val(c),$("#ctrl-tlmode input[value="+f+"]").prop("checked",!0).trigger("change"),timeSel={data:{x:{min:a.min,max:a.max}},fmin:0,fmax:0},$("#map-opacity").val(parseFloat(g)).trigger("input"),$("#maplayer-shape").get(0).checked=h>1,$("#maplayer-labels").get(0).checked=h%2,changeTileSrc(),leafly.setView([j,i],k,{reset:!0}),$("#filter fieldset[data-gid="+d+"] input").get(e).click(),attachMapHandlers()}!function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new B(a)};"undefined"!=typeof module&&module.exports?(module.exports=w,w._=w):a._=w,w.VERSION="1.1.7";var x=w.each=w.forEach=function(a,b,d){if(null!=a)if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(j.call(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=function(a,b,c){var d=[];return null==a?d:l&&a.map===l?a.map(b,c):(x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=void 0!==c;if(null==a&&(a=[]),m&&a.reduce===m)return d&&(b=w.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){if(null==a&&(a=[]),n&&a.reduceRight===n)return d&&(b=w.bind(b,d)),void 0!==c?a.reduceRight(b,c):a.reduceRight(b);var e=(w.isArray(a)?a.slice():w.toArray(a)).reverse();return w.reduce(e,b,c,d)},w.find=w.detect=function(a,b,c){var d;return y(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},w.filter=w.select=function(a,b,c){var d=[];return null==a?d:o&&a.filter===o?a.filter(b,c):(x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w.reject=function(a,b,c){var d=[];return null==a?d:(x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},w.every=w.all=function(a,b,d){var e=!0;return null==a?e:p&&a.every===p?a.every(b,d):(x(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),e)};var y=w.some=w.any=function(a,b,d){b=b||w.identity;var e=!1;return null==a?e:q&&a.some===q?a.some(b,d):(x(a,function(a,f,g){return(e|=b.call(d,a,f,g))?c:void 0}),!!e)};w.include=w.contains=function(a,b){var c=!1;return null==a?c:r&&a.indexOf===r?-1!=a.indexOf(b):(y(a,function(a){return(c=a===b)?!0:void 0}),c)},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a))return Math.max.apply(Math,a);var d={computed:-1/0};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},w.min=function(a,b,c){if(!b&&w.isArray(a))return Math.min.apply(Math,a);var d={computed:1/0};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},w.sortBy=function(a,b,c){return w.pluck(w.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={};return x(a,function(a,d){var e=b(a,d);(c[e]||(c[e]=[])).push(a)}),c},w.sortedIndex=function(a,b,c){c||(c=w.identity);for(var d=0,e=a.length;e>d;){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?a.toArray?a.toArray():w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):w.values(a):[]},w.size=function(a){return w.toArray(a).length},w.first=w.head=function(a,b,c){return null==b||c?a[0]:g.call(a,0,b)},w.rest=w.tail=function(a,b,c){return g.call(a,null==b||c?1:b)},w.last=function(a){return a[a.length-1]},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a){return w.reduce(a,function(a,b){return w.isArray(b)?a.concat(w.flatten(b)):(a[a.length]=b,a)},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b){return w.reduce(a,function(a,c,d){return 0!=d&&(b===!0?w.last(a)==c:w.include(a,c))||(a[a.length]=c),a},[])},w.union=function(){return w.uniq(w.flatten(arguments))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a,b){return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){for(var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(null==a)return-1;var d,e;if(c)return d=w.sortedIndex(a,b),a[d]===b?d:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;e>d;d++)if(a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(null==a)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},w.bind=function(a,b){if(a.bind===v&&v)return v.apply(a,g.call(arguments,1));var c=g.call(arguments,2);return function(){return a.apply(b,c.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);return 0==b.length&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)}),a},w.memoize=function(a,b){var c={};return b||(b=w.identity),function(){var d=b.apply(this,arguments);return j.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))};var z=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),(c||!d)&&(d=setTimeout(g,b))}};w.throttle=function(a,b){return z(a,b,!1)},w.debounce=function(a,b){return z(a,b,!0)},w.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments))}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments));return b.apply(this,c)}},w.compose=function(){var a=g.call(arguments);return function(){for(var b=g.call(arguments),c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)j.call(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){return x(g.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},w.defaults=function(a){return x(g.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])}),a},w.clone=function(a){return w.isArray(a)?a.slice():w.extend({},a)},w.tap=function(a,b){return b(a),a},w.isEqual=function(a,b){if(a===b)return!0;var c=typeof a,d=typeof b;if(c!=d)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped),a.isEqual)return a.isEqual(b);if(b.isEqual)return b.isEqual(a);if(w.isDate(a)&&w.isDate(b))return a.getTime()===b.getTime();if(w.isNaN(a)&&w.isNaN(b))return!1;if(w.isRegExp(a)&&w.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if("object"!==c)return!1;if(a.length&&a.length!==b.length)return!1;var e=w.keys(a),f=w.keys(b);if(e.length!=f.length)return!1;for(var g in a)if(!(g in b&&w.isEqual(a[g],b[g])))return!1;return!0},w.isEmpty=function(a){if(w.isArray(a)||w.isString(a))return 0===a.length;for(var b in a)if(j.call(a,b))return!1;return!0},w.isElement=function(a){return!(!a||1!=a.nodeType)},w.isArray=t||function(a){return"[object Array]"===i.call(a)},w.isObject=function(a){return a===Object(a)},w.isArguments=function(a){return!(!a||!j.call(a,"callee"))},w.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},w.isString=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},w.isNumber=function(a){return!!(0===a||a&&a.toExponential&&a.toFixed)},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1},w.isDate=function(a){return!!(a&&a.getTimezoneOffset&&a.setUTCFullYear)},w.isRegExp=function(a){return!(!(a&&a.test&&a.exec)||!a.ignoreCase&&a.ignoreCase!==!1)},w.isNull=function(a){return null===a},w.isUndefined=function(a){return void 0===a},w.noConflict=function(){return a._=b,this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;a>d;d++)b.call(c,d)},w.mixin=function(a){x(w.functions(a),function(b){D(b,w[b]=a[b])})};var A=0;w.uniqueId=function(a){var b=A++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},w.template=function(a,b){var c=w.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj",d);return b?e(b):e};var B=function(a){this._wrapped=a};w.prototype=B.prototype;var C=function(a,b){return b?w(a).chain():a},D=function(a,b){B.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),C(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];B.prototype[a]=function(){return b.apply(this._wrapped,arguments),C(this._wrapped,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];B.prototype[a]=function(){return C(b.apply(this._wrapped,arguments),this._chain)
}}),B.prototype.chain=function(){return this._chain=!0,this},B.prototype.value=function(){return this._wrapped}}(),!function(a,b,c){"undefined"!=typeof module?module.exports=c(a,b):"function"==typeof define&&"object"==typeof define.amd?define(c):b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l=document||{},m=l.documentElement||{},n=m[h],o=n?h:i,p=Array.prototype.slice,q=/click|mouse|menu|drag|drop/i,r=/^touch|^gesture/i,s={one:1},t=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(n?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),u=function(){function a(a,b){for(;null!==(b=b.parentNode);)if(b===a)return!0;return!1}function b(b){var c=b.relatedTarget;return c?c!==this&&"xul"!==c.prefix&&!/document/.test(this.toString())&&!a(this,c):null===c}return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),v=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=a.concat("char charCode key keyCode".split(" ")),d=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),f="preventDefault",g=function(a){return function(){a[f]?a[f]():a.returnValue=!1}},h="stopPropagation",i=function(a){return function(){a[h]?a[h]():a.cancelBubble=!0}},j=function(a){return function(){a[f](),a[h](),a.stopped=!0}},k=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(n,o){var p={originalEvent:n,isNative:o};if(!n)return p;var s,t=n.type,u=n.target||n.srcElement;return p[f]=g(n),p[h]=i(n),p.stop=j(p),p.target=u&&3===u.nodeType?u.parentNode:u,o&&(-1!==t.indexOf("key")?(s=c,p.keyCode=n.which||n.keyCode):q.test(t)?(s=b,p.rightClick=3===n.which||2===n.button,p.pos={x:0,y:0},n.pageX||n.pageY?(p.clientX=n.pageX,p.clientY=n.pageY):(n.clientX||n.clientY)&&(p.clientX=n.clientX+l.body.scrollLeft+m.scrollLeft,p.clientY=n.clientY+l.body.scrollTop+m.scrollTop),e.test(t)&&(p.relatedTarget=n.relatedTarget||n[("mouseover"===t?"from":"to")+"Element"])):r.test(t)&&(s=d),k(n,p,s||a)),p}}(),w=function(a,b){return n||b||a!==l&&a!==c?a:m},x=function(){function a(a,b,c,d,e){this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=u[b],this.isNative=t[b]&&a[o],this.eventType=n||this.isNative?b:"propertychange",this.customType=!n&&!this.isNative&&b,this.target=w(a,this.isNative),this.eventSupport=this.target[o]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return!(this.element!==a||b&&this.original!==b||c&&this.handler!==c)}},a}(),y=function(){var a={},b=function(c,d,e,f,g){if(d&&"*"!==d){var h,i=0,j=a["$"+d],k="*"===c;if(!j)return;for(h=j.length;h>i;i++)if((k||j[i].matches(c,e,f))&&!g(j[i],j,i,d))return}else for(var l in a)"$"===l.charAt(0)&&b(c,l.substr(1),e,f,g)},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),0===c.length&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)"$"===b.charAt(0)&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),z=n?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&null===a["_on"+e]&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},A=function(a,b,d){return function(e){return e=v(e||((this.ownerDocument||this.document||this).parentWindow||c).event,!0),b.apply(a,[e].concat(d))}},B=function(a,b,d,e,f,g){return function(h){(e?e.apply(this,arguments):n?!0:h&&h.propertyName==="_on"+d||!h)&&(h&&(h=v(h||((this.ownerDocument||this.document||this).parentWindow||c).event,g)),b.apply(a,!h||f&&0!==f.length?p.call(arguments,h?0:1).concat(f):arguments))}},C=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},D=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=y.get(a,i,c);for(e=0,f=j.length;f>e;e++)j[e].inNamespaces(d)&&((h=j[e]).eventSupport&&z(h.target,h.eventType,h.handler,!1,h.type),y.del(h))},E=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");return y.has(a,i,c)?a:("unload"===i&&(c=C(D,a,i,c,d)),u[i]&&(u[i].condition&&(c=B(a,c,i,u[i].condition,!0)),i=u[i].base||i),h=y.put(new x(a,i,c,d,j[0]&&j)),h.handler=h.isNative?A(a,h.handler,e):B(a,h.handler,i,!1,e,!1),void(h.eventSupport&&z(h.target,h.eventType,h.handler,!0,h.customType)))},F=function(a,b,c){return function(d){var e,f,g="string"==typeof a?c(a,this):a;for(e=d.target;e&&e!==this;e=e.parentNode)for(f=g.length;f--;)if(g[f]===e)return b.apply(e,arguments)}},G=function(a,b,c){var d,e,h,i,j=D,k=b&&"string"==typeof b;if(k&&b.indexOf(" ")>0){for(b=b.split(" "),i=b.length;i--;)G(a,b[i],c);return a}if(e=k&&b.replace(g,""),e&&u[e]&&(e=u[e].type),!b||k)(h=k&&b.replace(f,""))&&(h=h.split(".")),j(a,e,c,h);else if("function"==typeof b)j(a,null,b);else for(d in b)b.hasOwnProperty(d)&&G(a,d,b[d]);return a},H=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&"string"==typeof c;if(b&&!c&&"object"==typeof b)for(f in b)b.hasOwnProperty(f)&&H.apply(this,[a,f,b[f]]);else for(i=arguments.length>3?p.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=F(b,j=d,e))&&(i=p.call(i,1)),this===s&&(c=C(G,a,b,c,j)),h=g.length;h--;)E(a,g[h],c,j,i);return a},I=function(){return H.apply(s,arguments)},J=n?function(a,b,d){var e=l.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=w(c,a),a?c.fireEvent("on"+b,l.createEventObject()):c["_on"+b]++},K=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;)if(b=k[d].replace(g,""),(i=k[d].replace(f,""))&&(i=i.split(".")),i||c||!a[o])for(j=y.get(a,b),c=[!1].concat(c),e=0,h=j.length;h>e;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c);else J(t[b],b,a);return a},L=function(a,b,c){for(var d=0,e=y.get(b,c),f=e.length;f>d;d++)e[d].original&&H(a,e[d].type,e[d].original);return a},M={add:H,one:I,remove:G,clone:L,fire:K,noConflict:function(){return b[a]=d,this}};if(c[i]){var N=function(){var a,b=y.entries();for(a in b)b[a].type&&"unload"!==b[a].type&&G(b[a].element,b[a].type);c[k]("onunload",N),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",N)}return M}),function(){var a,b=this,c=this.Flotr;a={_:_,bean:bean,isIphone:/iphone/i.test(navigator.userAgent),isIE:-1!=navigator.appVersion.indexOf("MSIE")?parseFloat(navigator.appVersion.split("MSIE")[1]):!1,graphTypes:{},plugins:{},addType:function(b,c){a.graphTypes[b]=c,a.defaultOptions[b]=c.options||{},a.defaultOptions.defaultType=a.defaultOptions.defaultType||b},addPlugin:function(b,c){a.plugins[b]=c,a.defaultOptions[b]=c.options||{}},draw:function(b,c,d,e){return new(e=e||a.Graph)(b,c,d)},merge:function(b,c){var d,e,f=c||{};for(d in b)e=b[d],f[d]=e&&"object"==typeof e?e.constructor===Array?this._.clone(e):e.constructor===RegExp||this._.isElement(e)?e:a.merge(e,c?c[d]:void 0):e;return f},clone:function(b){return a.merge(b,{})},getTickSize:function(b,c,d,e){var f=(d-c)/b,g=a.getMagnitude(f),h=10,i=f/g;return 1.5>i?h=1:2.25>i?h=2:3>i?h=0===e?2:2.5:7.5>i&&(h=5),h*g},defaultTickFormatter:function(a){return a+""},defaultTrackFormatter:function(a){return"("+a.x+", "+a.y+")"},engineeringNotation:function(a,b,c){var d=["Y","Z","E","P","T","G","M","k",""],e=["y","z","a","f","p","n","µ","m",""],f=d.length;if(c=c||1e3,b=Math.pow(10,b||2),0===a)return 0;if(a>1)for(;f--&&a>=c;)a/=c;else for(d=e,f=d.length;f--&&1>a;)a*=c;return Math.round(a*b)/b+d[f]},getMagnitude:function(a){return Math.pow(10,Math.floor(Math.log(a)/Math.LN10))},toPixel:function(a){return Math.floor(a)+.5},toRad:function(a){return-a*(Math.PI/180)},floorInBase:function(a,b){return b*Math.floor(a/b)},drawText:function(b,c,d,e,f){return b.fillText?(f=this._.extend({size:a.defaultOptions.fontSize,color:"#000000",textAlign:"left",textBaseline:"bottom",weight:1,angle:0},f),b.save(),b.translate(d,e),b.rotate(f.angle),b.fillStyle=f.color,b.font=(f.weight>1?"bold ":"")+1.3*f.size+"px sans-serif",b.textAlign=f.textAlign,b.textBaseline=f.textBaseline,b.fillText(c,0,0),void b.restore()):void b.drawText(c,d,e,f)},getBestTextAlign:function(b,c){return c=c||{textAlign:"center",textBaseline:"middle"},b+=a.getTextAngleFromAlign(c),Math.abs(Math.cos(b))>.01&&(c.textAlign=Math.cos(b)>0?"right":"left"),Math.abs(Math.sin(b))>.01&&(c.textBaseline=Math.sin(b)>0?"top":"bottom"),c},alignTable:{"right middle":0,"right top":Math.PI/4,"center top":Math.PI/2,"left top":3*(Math.PI/4),"left middle":Math.PI,"left bottom":-3*(Math.PI/4),"center bottom":-Math.PI/2,"right bottom":-Math.PI/4,"center middle":0},getTextAngleFromAlign:function(b){return a.alignTable[b.textAlign+" "+b.textBaseline]||0},noConflict:function(){return b.Flotr=c,this}},b.Flotr=a}(),Flotr.defaultOptions={colors:["#00A8F0","#C0D800","#CB4B4B","#4DA74D","#9440ED"],ieBackgroundColor:"#FFFFFF",title:null,subtitle:null,shadowSize:4,defaultType:null,HtmlText:!0,fontColor:"#545454",fontSize:7.5,resolution:1,parseFloat:!0,preventDefault:!0,xaxis:{ticks:null,minorTicks:null,showLabels:!0,showMinorLabels:!1,labelsAngle:0,title:null,titleAngle:0,noTicks:5,minorTickFreq:null,tickFormatter:Flotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscale:!1,autoscaleMargin:0,color:null,mode:"normal",timeFormat:null,timeMode:"UTC",timeUnit:"millisecond",scaling:"linear",base:Math.E,titleAlign:"center",margin:!0},x2axis:{},yaxis:{ticks:null,minorTicks:null,showLabels:!0,showMinorLabels:!1,labelsAngle:0,title:null,titleAngle:90,noTicks:5,minorTickFreq:null,tickFormatter:Flotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscale:!1,autoscaleMargin:0,color:null,scaling:"linear",base:Math.E,titleAlign:"center",margin:!0},y2axis:{titleAngle:270},grid:{color:"#545454",backgroundColor:null,backgroundImage:null,watermarkAlpha:.4,tickColor:"#DDDDDD",labelMargin:3,verticalLines:!0,minorVerticalLines:null,horizontalLines:!0,minorHorizontalLines:null,outlineWidth:1,outline:"nsew",circular:!1},mouse:{track:!1,trackAll:!1,position:"se",relative:!1,trackFormatter:Flotr.defaultTrackFormatter,margin:5,lineColor:"#FF3F19",trackDecimals:1,sensibility:2,trackY:!0,radius:3,fillColor:null,fillOpacity:.4}},function(){function a(){this.rgba=["r","g","b","a"];for(var a=4;-1<--a;)this[this.rgba[a]]=arguments[a]||(3==a?1:0);this.normalize()}var b=Flotr._,c={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]};a.prototype={scale:function(){for(var a=4;-1<--a;)b.isUndefined(arguments[a])||(this[this.rgba[a]]*=arguments[a]);return this.normalize()},alpha:function(a){return b.isUndefined(a)||b.isNull(a)||(this.a=a),this.normalize()},clone:function(){return new a(this.r,this.b,this.g,this.a)},limit:function(a,b,c){return Math.max(Math.min(a,c),b)},normalize:function(){var a=this.limit;return this.r=a(parseInt(this.r,10),0,255),this.g=a(parseInt(this.g,10),0,255),this.b=a(parseInt(this.b,10),0,255),this.a=a(this.a,0,1),this},distance:function(b){if(b){b=new a.parse(b);for(var c=0,d=3;-1<--d;)c+=Math.abs(this[this.rgba[d]]-b[this.rgba[d]]);return c}},toString:function(){return this.a>=1?"rgb("+[this.r,this.g,this.b].join(",")+")":"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"},contrast:function(){var a=1-(.299*this.r+.587*this.g+.114*this.b)/255;return.5>a?"#000000":"#ffffff"}},b.extend(a,{parse:function(b){if(b instanceof a)return b;var d;if(d=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))return new a(parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16));if(d=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))return new a(parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10));if(d=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))return new a(parseInt(d[1]+d[1],16),parseInt(d[2]+d[2],16),parseInt(d[3]+d[3],16));if(d=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(b))return new a(parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10),parseFloat(d[4]));if(d=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))return new a(2.55*parseFloat(d[1]),2.55*parseFloat(d[2]),2.55*parseFloat(d[3]));if(d=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(b))return new a(2.55*parseFloat(d[1]),2.55*parseFloat(d[2]),2.55*parseFloat(d[3]),parseFloat(d[4]));var e=(b+"").replace(/^\s*([\S\s]*?)\s*$/,"$1").toLowerCase();return"transparent"==e?new a(255,255,255,0):(d=c[e])?new a(d[0],d[1],d[2]):new a(0,0,0,0)},processColor:function(c,d){var e=d.opacity;if(!c)return"rgba(0, 0, 0, 0)";if(c instanceof a)return c.alpha(e).toString();if(b.isString(c))return a.parse(c).alpha(e).toString();var f=c.colors?c:{colors:c};if(!d.ctx)return b.isArray(f.colors)?a.parse(b.isArray(f.colors[0])?f.colors[0][1]:f.colors[0]).alpha(e).toString():"rgba(0, 0, 0, 0)";f=b.extend({start:"top",end:"bottom"},f),/top/i.test(f.start)&&(d.x1=0),/left/i.test(f.start)&&(d.y1=0),/bottom/i.test(f.end)&&(d.x2=0),/right/i.test(f.end)&&(d.y2=0);var g,h,i,j=d.ctx.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(g=0;g<f.colors.length;g++)h=f.colors[g],b.isArray(h)?(i=h[0],h=h[1]):i=g/(f.colors.length-1),j.addColorStop(i,a.parse(h).alpha(e));return j}}),Flotr.Color=a}(),Flotr.Date={set:function(a,b,c,d){c=c||"UTC",b="set"+("UTC"===c?"UTC":"")+b,a[b](d)},get:function(a,b,c){return c=c||"UTC",b="get"+("UTC"===c?"UTC":"")+b,a[b]()},format:function(a,b,c){function d(a){return a+="",1==a.length?"0"+a:a}if(a){for(var e,f=this.get,g={h:f(a,"Hours",c).toString(),H:d(f(a,"Hours",c)),M:d(f(a,"Minutes",c)),S:d(f(a,"Seconds",c)),s:f(a,"Milliseconds",c),d:f(a,"Date",c).toString(),m:(f(a,"Month",c)+1).toString(),y:f(a,"FullYear",c).toString(),b:Flotr.Date.monthNames[f(a,"Month",c)]},h=[],i=!1,j=0;j<b.length;++j)e=b.charAt(j),i?(h.push(g[e]||e),i=!1):"%"==e?i=!0:h.push(e);return h.join("")}},getFormat:function(a,b){var c=Flotr.Date.timeUnits;return a<c.second?"%h:%M:%S.%s":a<c.minute?"%h:%M:%S":a<c.day?b<2*c.day?"%h:%M":"%b %d %h:%M":a<c.month?"%b %d":a<c.year?b<c.year?"%b":"%b %y":"%y"},formatter:function(a,b){var c=b.options,d=Flotr.Date.timeUnits[c.timeUnit],e=new Date(a*d);if(b.options.timeFormat)return Flotr.Date.format(e,c.timeFormat,c.timeMode);var f=(b.max-b.min)*d,g=b.tickSize*Flotr.Date.timeUnits[b.tickUnit];return Flotr.Date.format(e,Flotr.Date.getFormat(g,f),c.timeMode)},generator:function(a){function b(a){f(r,a,k,Flotr.floorInBase(g(r,a,k),q))}var c,d,e,f=this.set,g=this.get,h=this.timeUnits,i=this.spec,j=a.options,k=j.timeMode,l=h[j.timeUnit],m=a.min*l,n=a.max*l,o=(n-m)/j.noTicks,p=[],q=a.tickSize;for(d=j.tickFormatter===Flotr.defaultTickFormatter?this.formatter:j.tickFormatter,e=0;e<i.length-1;++e){var r=i[e][0]*h[i[e][1]];if(o<(r+i[e+1][0]*h[i[e+1][1]])/2&&r>=q)break}q=i[e][0],c=i[e][1],"year"==c&&(q=Flotr.getTickSize(j.noTicks*h.year,m,n,0),.5==q&&(c="month",q=6)),a.tickUnit=c,a.tickSize=q;var s=q*h[c];switch(r=new Date(m),c){case"millisecond":b("Milliseconds");break;case"second":b("Seconds");break;case"minute":b("Minutes");break;case"hour":b("Hours");break;case"month":b("Month");break;case"year":b("FullYear")}s>=h.second&&f(r,"Milliseconds",k,0),s>=h.minute&&f(r,"Seconds",k,0),s>=h.hour&&f(r,"Minutes",k,0),s>=h.day&&f(r,"Hours",k,0),s>=4*h.day&&f(r,"Date",k,1),s>=h.year&&f(r,"Month",k,0);var t,u=0,v=0/0;do if(t=v,v=r.getTime(),p.push({v:v/l,label:d(v/l,a)}),"month"==c)if(1>q){f(r,"Date",k,1);var w=r.getTime();f(r,"Month",k,g(r,"Month",k)+1);var x=r.getTime();r.setTime(v+u*h.hour+(x-w)*q),u=g(r,"Hours",k),f(r,"Hours",k,0)}else f(r,"Month",k,g(r,"Month",k)+q);else"year"==c?f(r,"FullYear",k,g(r,"FullYear",k)+q):r.setTime(v+s);while(n>v&&v!=t);return p},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,year:31556952e3},spec:[[1,"millisecond"],[20,"millisecond"],[50,"millisecond"],[100,"millisecond"],[200,"millisecond"],[500,"millisecond"],[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},function(){var a=Flotr._;Flotr.DOM={addClass:function(b,c){var d=b.className?b.className:"";a.include(d.split(/\s+/g),c)||(b.className=(d?d+" ":"")+c)},create:function(a){return document.createElement(a)},node:function(a){var b,c=Flotr.DOM.create("div");return c.innerHTML=a,b=c.children[0],c.innerHTML="",b},empty:function(a){a.innerHTML=""},hide:function(a){Flotr.DOM.setStyles(a,{display:"none"})},insert:function(b,c){a.isString(c)?b.innerHTML+=c:a.isElement(c)&&b.appendChild(c)},opacity:function(a,b){a.style.opacity=b},position:function(a,b){return a.offsetParent?(b=this.position(a.offsetParent),b.left+=a.offsetLeft,b.top+=a.offsetTop,b):{left:a.offsetLeft||0,top:a.offsetTop||0}},removeClass:function(b,c){var d=b.className?b.className:"";b.className=a.filter(d.split(/\s+/g),function(a){return a!=c?!0:void 0}).join(" ")},setStyles:function(b,c){a.each(c,function(a,c){b.style[c]=a})},show:function(a){Flotr.DOM.setStyles(a,{display:""})},size:function(a){return{height:a.offsetHeight,width:a.offsetWidth}}}}(),function(){var a=Flotr,b=a.bean;a.EventAdapter={observe:function(a,c,d){return b.add(a,c,d),this},fire:function(a,c,d){return b.fire(a,c,d),"undefined"!=typeof Prototype&&Event.fire(a,c,d),this},stopObserving:function(a,c,d){return b.remove(a,c,d),this},eventPointer:function(b){if(!a._.isUndefined(b.touches)&&b.touches.length>0)return{x:b.touches[0].pageX,y:b.touches[0].pageY};if(!a._.isUndefined(b.changedTouches)&&b.changedTouches.length>0)return{x:b.changedTouches[0].pageX,y:b.changedTouches[0].pageY};if(b.pageX||b.pageY)return{x:b.pageX,y:b.pageY};if(b.clientX||b.clientY){var c=document,d=c.body,e=c.documentElement;return{x:b.clientX+d.scrollLeft+e.scrollLeft,y:b.clientY+d.scrollTop+e.scrollTop}}}}}(),function(){function a(){return c.observe.apply(this,arguments),this._handles.push(arguments),this}var b=Flotr.DOM,c=Flotr.EventAdapter,d=Flotr._,e=Flotr;Graph=function(a,b,f){this._setEl(a),this._initMembers(),this._initPlugins(),c.fire(this.el,"flotr:beforeinit",[this]),this.data=b,this.series=e.Series.getSeries(b),this._initOptions(f),this._initGraphTypes(),this._initCanvas(),this._text=new e.Text({element:this.el,ctx:this.ctx,html:this.options.HtmlText,textEnabled:this.textEnabled}),c.fire(this.el,"flotr:afterconstruct",[this]),this._initEvents(),this.findDataRanges(),this.calculateSpacing(),this.draw(d.bind(function(){c.fire(this.el,"flotr:afterinit",[this])},this))},Graph.prototype={destroy:function(){c.fire(this.el,"flotr:destroy"),d.each(this._handles,function(a){c.stopObserving.apply(this,a)}),this._handles=[],this.el.graph=null},observe:a,_observe:a,processColor:function(a,b){var c={x1:0,y1:0,x2:this.plotWidth,y2:this.plotHeight,opacity:1,ctx:this.ctx};return d.extend(c,b),e.Color.processColor(a,c)},findDataRanges:function(){var a,b,c,f=this.axes;d.each(this.series,function(d){c=d.getRange(),c&&(a=d.xaxis,b=d.yaxis,a.datamin=Math.min(c.xmin,a.datamin),a.datamax=Math.max(c.xmax,a.datamax),b.datamin=Math.min(c.ymin,b.datamin),b.datamax=Math.max(c.ymax,b.datamax),a.used=a.used||c.xused,b.used=b.used||c.yused)},this),f.x.used||f.x2.used||(f.x.used=!0),f.y.used||f.y2.used||(f.y.used=!0),d.each(f,function(a){a.calculateRange()});var g=d.keys(e.graphTypes),h=!1;d.each(this.series,function(a){a.hide||(d.each(g,function(b){a[b]&&a[b].show&&(this.extendRange(b,a),h=!0)},this),h||this.extendRange(this.options.defaultType,a))},this)},extendRange:function(a,b){this[a].extendRange&&this[a].extendRange(b,b.data,b[a],this[a]),this[a].extendYRange&&this[a].extendYRange(b.yaxis,b.data,b[a],this[a]),this[a].extendXRange&&this[a].extendXRange(b.xaxis,b.data,b[a],this[a])},calculateSpacing:function(){var a,b,c=this.axes,e=this.options,f=this.series,g=e.grid.labelMargin,h=this._text,i=c.x,j=c.x2,k=c.y,l=c.y2,m=e.grid.outlineWidth;for(d.each(c,function(a){a.calculateTicks(),a.calculateTextDimensions(h,e)}),b=h.dimensions(e.title,{size:1.5*e.fontSize},"font-size:1em;font-weight:bold;","flotr-title"),this.titleHeight=b.height,b=h.dimensions(e.subtitle,{size:e.fontSize},"font-size:smaller;","flotr-subtitle"),this.subtitleHeight=b.height,a=0;a<e.length;++a)f[a].points.show&&(m=Math.max(m,f[a].points.radius+f[a].points.lineWidth/2));var n=this.plotOffset;i.options.margin===!1?(n.bottom=0,n.top=0):(n.bottom+=(e.grid.circular?0:i.used&&i.options.showLabels?i.maxLabel.height+g:0)+(i.used&&i.options.title?i.titleSize.height+g:0)+m,n.top+=(e.grid.circular?0:j.used&&j.options.showLabels?j.maxLabel.height+g:0)+(j.used&&j.options.title?j.titleSize.height+g:0)+this.subtitleHeight+this.titleHeight+m),k.options.margin===!1?(n.left=0,n.right=0):(n.left+=(e.grid.circular?0:k.used&&k.options.showLabels?k.maxLabel.width+g:0)+(k.used&&k.options.title?k.titleSize.width+g:0)+m,n.right+=(e.grid.circular?0:l.used&&l.options.showLabels?l.maxLabel.width+g:0)+(l.used&&l.options.title?l.titleSize.width+g:0)+m),n.top=Math.floor(n.top),this.plotWidth=this.canvasWidth-n.left-n.right,this.plotHeight=this.canvasHeight-n.bottom-n.top,i.length=j.length=this.plotWidth,k.length=l.length=this.plotHeight,k.offset=l.offset=this.plotHeight,i.setScale(),j.setScale(),k.setScale(),l.setScale()},draw:function(a){var b,d=this.ctx;if(c.fire(this.el,"flotr:beforedraw",[this.series,this]),this.series.length){for(d.save(),d.translate(this.plotOffset.left,this.plotOffset.top),b=0;b<this.series.length;b++)this.series[b].hide||this.drawSeries(this.series[b]);d.restore(),this.clip()}c.fire(this.el,"flotr:afterdraw",[this.series,this]),a&&a()},drawSeries:function(a){function b(a,b){var c=this.getOptions(a,b);this[b].draw(c)}var c=!1;a=a||this.series,d.each(e.graphTypes,function(d,e){a[e]&&a[e].show&&this[e]&&(c=!0,b.call(this,a,e))},this),c||b.call(this,a,this.options.defaultType)},getOptions:function(a,b){var c=a[b],d=(this[b],a.xaxis),f=a.yaxis,g={context:this.ctx,width:this.plotWidth,height:this.plotHeight,fontSize:this.options.fontSize,fontColor:this.options.fontColor,textEnabled:this.textEnabled,htmlText:this.options.HtmlText,text:this._text,element:this.el,data:a.data,color:a.color,shadowSize:a.shadowSize,xScale:d.d2p,yScale:f.d2p,xInverse:d.p2d,yInverse:f.p2d};return g=e.merge(c,g),g.fillStyle=this.processColor(c.fillColor||a.color,{opacity:c.fillOpacity}),g},getEventPosition:function(a){var d,e,f,g=document,h=g.body,i=g.documentElement,j=this.axes,k=this.plotOffset,l=this.lastMousePos,m=c.eventPointer(a),n=m.x-l.pageX,o=m.y-l.pageY;return"ontouchstart"in this.el?(d=b.position(this.overlay),e=m.x-d.left-k.left,f=m.y-d.top-k.top):(d=this.overlay.getBoundingClientRect(),e=a.clientX-d.left-k.left-h.scrollLeft-i.scrollLeft,f=a.clientY-d.top-k.top-h.scrollTop-i.scrollTop),{x:j.x.p2d(e),x2:j.x2.p2d(e),y:j.y.p2d(f),y2:j.y2.p2d(f),relX:e,relY:f,dX:n,dY:o,absX:m.x,absY:m.y,pageX:m.x,pageY:m.y}},clickHandler:function(a){return this.ignoreClick?(this.ignoreClick=!1,this.ignoreClick):void c.fire(this.el,"flotr:click",[this.getEventPosition(a),this])},mouseMoveHandler:function(a){if(!this.mouseDownMoveHandler){var b=this.getEventPosition(a);c.fire(this.el,"flotr:mousemove",[a,b,this]),this.lastMousePos=b}},mouseDownHandler:function(a){this.mouseUpHandler||(this.mouseUpHandler=d.bind(function(a){c.stopObserving(document,"mouseup",this.mouseUpHandler),c.stopObserving(document,"mousemove",this.mouseDownMoveHandler),this.mouseDownMoveHandler=null,this.mouseUpHandler=null,c.fire(this.el,"flotr:mouseup",[a,this])},this),this.mouseDownMoveHandler=d.bind(function(b){var d=this.getEventPosition(b);c.fire(this.el,"flotr:mousemove",[a,d,this]),this.lastMousePos=d},this),c.observe(document,"mouseup",this.mouseUpHandler),c.observe(document,"mousemove",this.mouseDownMoveHandler),c.fire(this.el,"flotr:mousedown",[a,this]),this.ignoreClick=!1)},drawTooltip:function(a,c,d,e){var f=this.getMouseTrack(),g="opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;",h=e.position,i=e.margin,j=this.plotOffset;null!==c&&null!==d?(e.relative?("n"==h.charAt(0)?g+="bottom:"+(i-j.top-d+this.canvasHeight)+"px;top:auto;":"s"==h.charAt(0)&&(g+="top:"+(i+j.top+d)+"px;bottom:auto;"),"e"==h.charAt(1)?g+="left:"+(i+j.left+c)+"px;right:auto;":"w"==h.charAt(1)&&(g+="right:"+(i-j.left-c+this.canvasWidth)+"px;left:auto;")):("n"==h.charAt(0)?g+="top:"+(i+j.top)+"px;bottom:auto;":"s"==h.charAt(0)&&(g+="bottom:"+(i+j.bottom)+"px;top:auto;"),"e"==h.charAt(1)?g+="right:"+(i+j.right)+"px;left:auto;":"w"==h.charAt(1)&&(g+="left:"+(i+j.left)+"px;right:auto;")),f.style.cssText=g,b.empty(f),b.insert(f,a),b.show(f)):b.hide(f)},clip:function(a){var b=this.plotOffset,c=this.canvasWidth,d=this.canvasHeight;a=a||this.ctx,e.isIE&&e.isIE<9?(a.save(),a.fillStyle=this.processColor(this.options.ieBackgroundColor),a.fillRect(0,0,c,b.top),a.fillRect(0,0,b.left,d),a.fillRect(0,d-b.bottom,c,b.bottom),a.fillRect(c-b.right,0,b.right,d),a.restore()):(a.clearRect(0,0,c,b.top),a.clearRect(0,0,b.left,d),a.clearRect(0,d-b.bottom,c,b.bottom),a.clearRect(c-b.right,0,b.right,d))},_initMembers:function(){this._handles=[],this.lastMousePos={pageX:null,pageY:null},this.plotOffset={left:0,right:0,top:0,bottom:0},this.ignoreClick=!0,this.prevHit=null},_initGraphTypes:function(){d.each(e.graphTypes,function(a,b){this[b]=e.clone(a)},this)},_initEvents:function(){var a,b,e,f=this.el;"ontouchstart"in f?(a=d.bind(function(d){e=!0,c.stopObserving(document,"touchend",a),c.fire(f,"flotr:mouseup",[event,this]),this.multitouches=null,b||this.clickHandler(d)},this),this.observe(this.overlay,"touchstart",d.bind(function(d){b=!1,e=!1,this.ignoreClick=!1,d.touches&&d.touches.length>1&&(this.multitouches=d.touches),c.fire(f,"flotr:mousedown",[event,this]),this.observe(document,"touchend",a)},this)),this.observe(this.overlay,"touchmove",d.bind(function(a){var d=this.getEventPosition(a);this.options.preventDefault&&a.preventDefault(),b=!0,this.multitouches||a.touches&&a.touches.length>1?this.multitouches=a.touches:e||c.fire(f,"flotr:mousemove",[event,d,this]),this.lastMousePos=d},this))):this.observe(this.overlay,"mousedown",d.bind(this.mouseDownHandler,this)).observe(f,"mousemove",d.bind(this.mouseMoveHandler,this)).observe(this.overlay,"click",d.bind(this.clickHandler,this)).observe(f,"mouseout",function(){c.fire(f,"flotr:mouseout")})},_initCanvas:function(){function a(a,c){return a||(a=b.create("canvas"),"undefined"!=typeof FlashCanvas&&"function"==typeof a.getContext&&FlashCanvas.initElement(a),a.className="flotr-"+c,a.style.cssText="position:absolute;left:0px;top:0px;",b.insert(h,a)),d.each(g,function(d,e){b.show(a),("canvas"!=c||a.getAttribute(e)!==d)&&(a.setAttribute(e,d*i.resolution),a.style[e]=d+"px")}),a.context_=null,a}function c(a){window.G_vmlCanvasManager&&window.G_vmlCanvasManager.initElement(a);var b=a.getContext("2d");return window.G_vmlCanvasManager||b.scale(i.resolution,i.resolution),b}var e,f,g,h=this.el,i=this.options,j=h.children,k=[];for(f=j.length;f--;)e=j[f],this.canvas||"flotr-canvas"!==e.className?this.overlay||"flotr-overlay"!==e.className?k.push(e):this.overlay=e:this.canvas=e;for(f=k.length;f--;)h.removeChild(k[f]);if(b.setStyles(h,{position:"relative"}),g={},g.width=h.clientWidth,g.height=h.clientHeight,g.width<=0||g.height<=0||i.resolution<=0)throw"Invalid dimensions for plot, width = "+g.width+", height = "+g.height+", resolution = "+i.resolution;this.canvas=a(this.canvas,"canvas"),this.overlay=a(this.overlay,"overlay"),this.ctx=c(this.canvas),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.octx=c(this.overlay),this.octx.clearRect(0,0,this.overlay.width,this.overlay.height),this.canvasHeight=g.height,this.canvasWidth=g.width,this.textEnabled=!!this.ctx.drawText||!!this.ctx.fillText},_initPlugins:function(){d.each(e.plugins,function(a,b){d.each(a.callbacks,function(a,b){this.observe(this.el,b,d.bind(a,this))},this),this[b]=e.clone(a),d.each(this[b],function(a,c){d.isFunction(a)&&(this[b][c]=d.bind(a,this))},this)},this)},_initOptions:function(a){var b=e.clone(e.defaultOptions);b.x2axis=d.extend(d.clone(b.xaxis),b.x2axis),b.y2axis=d.extend(d.clone(b.yaxis),b.y2axis),this.options=e.merge(a||{},b),null===this.options.grid.minorVerticalLines&&"logarithmic"===this.options.xaxis.scaling&&(this.options.grid.minorVerticalLines=!0),null===this.options.grid.minorHorizontalLines&&"logarithmic"===this.options.yaxis.scaling&&(this.options.grid.minorHorizontalLines=!0),c.fire(this.el,"flotr:afterinitoptions",[this]),this.axes=e.Axis.getAxes(this.options);var f,g,h,i,j=[],k=[],l=this.series.length,m=this.series.length,n=this.options.colors,o=[],p=0;for(g=m-1;g>-1;--g)f=this.series[g].color,f&&(--m,d.isNumber(f)?j.push(f):o.push(e.Color.parse(f)));for(g=j.length-1;g>-1;--g)m=Math.max(m,j[g]+1);for(g=0;k.length<m;){f=n.length==g?new e.Color(100,100,100):e.Color.parse(n[g]);var q=p%2==1?-1:1,r=1+q*Math.ceil(p/2)*.2;f.scale(r,r,r),k.push(f),++g>=n.length&&(g=0,++p)}for(g=0,h=0;l>g;++g){i=this.series[g],i.color?d.isNumber(i.color)&&(i.color=k[i.color].toString()):i.color=k[h++].toString(),i.xaxis||(i.xaxis=this.axes.x),1==i.xaxis?i.xaxis=this.axes.x:2==i.xaxis&&(i.xaxis=this.axes.x2),i.yaxis||(i.yaxis=this.axes.y),1==i.yaxis?i.yaxis=this.axes.y:2==i.yaxis&&(i.yaxis=this.axes.y2);for(var s in e.graphTypes)i[s]=d.extend(d.clone(this.options[s]),i[s]);i.mouse=d.extend(d.clone(this.options.mouse),i.mouse),d.isUndefined(i.shadowSize)&&(i.shadowSize=this.options.shadowSize)}},_setEl:function(a){if(!a)throw"The target container doesn't exist";if(a.graph instanceof Graph)a.graph.destroy();
else if(!a.clientWidth)throw"The target container must be visible";a.graph=this,this.el=a}},Flotr.Graph=Graph}(),function(){function a(a){this.orientation=1,this.offset=0,this.datamin=Number.MAX_VALUE,this.datamax=-Number.MAX_VALUE,d.extend(this,a)}function b(a,b){return a=Math.log(Math.max(a,Number.MIN_VALUE)),b!==Math.E&&(a/=Math.log(b)),a}function c(a,b){return b===Math.E?Math.exp(a):Math.pow(b,a)}var d=Flotr._,e="logarithmic";a.prototype={setScale:function(){var a,d=this.length,f=this.max,g=this.min,h=this.offset,i=this.orientation,j=this.options,k=j.scaling===e;a=k?d/(b(f,j.base)-b(g,j.base)):d/(f-g),this.scale=a,k?(this.d2p=function(c){return h+i*(b(c,j.base)-b(g,j.base))*a},this.p2d=function(d){return c((h+i*d)/a+b(g,j.base),j.base)}):(this.d2p=function(b){return h+i*(b-g)*a},this.p2d=function(b){return(h+i*b)/a+g})},calculateTicks:function(){var a=this.options;this.ticks=[],this.minorTicks=[],a.ticks?(this._cleanUserTicks(a.ticks,this.ticks),this._cleanUserTicks(a.minorTicks||[],this.minorTicks)):"time"==a.mode?this._calculateTimeTicks():"logarithmic"===a.scaling?this._calculateLogTicks():this._calculateTicks(),d.each(this.ticks,function(a){a.label+=""}),d.each(this.minorTicks,function(a){a.label+=""})},calculateRange:function(){if(this.used){var a=this,b=a.options,c=null!==b.min?b.min:a.datamin,d=null!==b.max?b.max:a.datamax,e=b.autoscaleMargin;if("logarithmic"==b.scaling&&(0>=c&&(c=a.datamin),0>=d&&(d=c)),d==c){var f=d?.01:1;null===b.min&&(c-=f),null===b.max&&(d+=f)}if("logarithmic"===b.scaling){0>c&&(c=d/b.base);var g=Math.log(d);b.base!=Math.E&&(g/=Math.log(b.base)),g=Math.ceil(g);var h=Math.log(c);b.base!=Math.E&&(h/=Math.log(b.base)),h=Math.ceil(h),a.tickSize=Flotr.getTickSize(b.noTicks,h,g,null===b.tickDecimals?0:b.tickDecimals),null===b.minorTickFreq&&(b.minorTickFreq=g-h>10?0:g-h>5?2:5)}else a.tickSize=Flotr.getTickSize(b.noTicks,c,d,b.tickDecimals);a.min=c,a.max=d,null===b.min&&b.autoscale&&(a.min-=a.tickSize*e,a.min<0&&a.datamin>=0&&(a.min=0),a.min=a.tickSize*Math.floor(a.min/a.tickSize)),null===b.max&&b.autoscale&&(a.max+=a.tickSize*e,a.max>0&&a.datamax<=0&&a.datamax!=a.datamin&&(a.max=0),a.max=a.tickSize*Math.ceil(a.max/a.tickSize)),a.min==a.max&&(a.max=a.min+1)}},calculateTextDimensions:function(a,b){var c,d,e="";if(this.options.showLabels)for(d=0;d<this.ticks.length;++d)c=this.ticks[d].label.length,c>e.length&&(e=this.ticks[d].label);this.maxLabel=a.dimensions(e,{size:b.fontSize,angle:Flotr.toRad(this.options.labelsAngle)},"font-size:smaller;","flotr-grid-label"),this.titleSize=a.dimensions(this.options.title,{size:1.2*b.fontSize,angle:Flotr.toRad(this.options.titleAngle)},"font-weight:bold;","flotr-axis-title")},_cleanUserTicks:function(a,b){var c,e,f,g,h=this,i=this.options;for(d.isFunction(a)&&(a=a({min:h.min,max:h.max})),e=0;e<a.length;++e)g=a[e],"object"==typeof g?(c=g[0],f=g.length>1?g[1]:i.tickFormatter(c,{min:h.min,max:h.max})):(c=g,f=i.tickFormatter(c,{min:this.min,max:this.max})),b[e]={v:c,label:f}},_calculateTimeTicks:function(){this.ticks=Flotr.Date.generator(this)},_calculateLogTicks:function(){var a,b,c=this,d=c.options,e=Math.log(c.max);d.base!=Math.E&&(e/=Math.log(d.base)),e=Math.ceil(e);var f=Math.log(c.min);for(d.base!=Math.E&&(f/=Math.log(d.base)),f=Math.ceil(f),i=f;i<e;i+=c.tickSize){b=d.base==Math.E?Math.exp(i):Math.pow(d.base,i);var g=b*(d.base==Math.E?Math.exp(c.tickSize):Math.pow(d.base,c.tickSize)),h=(g-b)/d.minorTickFreq;for(c.ticks.push({v:b,label:d.tickFormatter(b,{min:c.min,max:c.max})}),a=b+h;g>a;a+=h)c.minorTicks.push({v:a,label:d.tickFormatter(a,{min:c.min,max:c.max})})}b=d.base==Math.E?Math.exp(i):Math.pow(d.base,i),c.ticks.push({v:b,label:d.tickFormatter(b,{min:c.min,max:c.max})})},_calculateTicks:function(){var a,b,c,d,e,f,g=this,h=g.options,i=g.tickSize,j=g.min,k=g.max,l=i*Math.ceil(j/i);for(h.minorTickFreq&&(b=i/h.minorTickFreq),e=0;(c=d=l+e*i)<=k;++e)if(a=h.tickDecimals,null===a&&(a=1-Math.floor(Math.log(i)/Math.LN10)),0>a&&(a=0),c=c.toFixed(a),g.ticks.push({v:c,label:h.tickFormatter(c,{min:g.min,max:g.max})}),h.minorTickFreq)for(f=0;f<h.minorTickFreq&&k>e*i+f*b;++f)c=d+f*b,g.minorTicks.push({v:c,label:h.tickFormatter(c,{min:g.min,max:g.max})})}},d.extend(a,{getAxes:function(b){return{x:new a({options:b.xaxis,n:1,length:this.plotWidth}),x2:new a({options:b.x2axis,n:2,length:this.plotWidth}),y:new a({options:b.yaxis,n:1,length:this.plotHeight,offset:this.plotHeight,orientation:-1}),y2:new a({options:b.y2axis,n:2,length:this.plotHeight,offset:this.plotHeight,orientation:-1})}}}),Flotr.Axis=a}(),function(){function a(a){b.extend(this,a)}var b=Flotr._;a.prototype={getRange:function(){var a,b,c,d=this.data,e=d.length,f=Number.MAX_VALUE,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=-Number.MAX_VALUE,j=!1,k=!1;if(0>e||this.hide)return!1;for(c=0;e>c;c++)a=d[c][0],b=d[c][1],null!==a&&(f>a&&(f=a,j=!0),a>h&&(h=a,j=!0)),null!==b&&(g>b&&(g=b,k=!0),b>i&&(i=b,k=!0));return{xmin:f,xmax:h,ymin:g,ymax:i,xused:j,yused:k}}},b.extend(a,{getSeries:function(c){return b.map(c,function(c){var d;return c.data?(d=new a,b.extend(d,c)):d=new a({data:c}),d})}}),Flotr.Series=a}(),function(){var a=Flotr,b=a.DOM,c=a._,d=function(a){this.o=a};d.prototype={dimensions:function(a,b,c,d){return a?this.o.html?this.html(a,this.o.element,c,d):this.canvas(a,b):{width:0,height:0}},canvas:function(b,c){if(this.o.textEnabled){c=c||{};var d,e=this.measureText(b,c),f=e.width,g=c.size||a.defaultOptions.fontSize,h=c.angle||0,i=Math.cos(h),j=Math.sin(h),k=2,l=6;return d={width:Math.abs(i*f)+Math.abs(j*g)+k,height:Math.abs(j*f)+Math.abs(i*g)+l}}},html:function(a,c,d,e){var f=b.create("div");return b.setStyles(f,{position:"absolute",top:"-10000px"}),b.insert(f,'<div style="'+d+'" class="'+e+' flotr-dummy-div">'+a+"</div>"),b.insert(this.o.element,f),b.size(f)},measureText:function(b,d){var e,f=this.o.ctx;return!f.fillText||a.isIphone&&f.measure?{width:f.measure(b,d)}:(d=c.extend({size:a.defaultOptions.fontSize,weight:1,angle:0},d),f.save(),f.font=(d.weight>1?"bold ":"")+1.3*d.size+"px sans-serif",e=f.measureText(b),f.restore(),e)}},Flotr.Text=d}(),Flotr.addType("lines",{options:{show:!1,lineWidth:2,fill:!1,fillBorder:!1,fillColor:null,fillOpacity:.4,steps:!1,stacked:!1},stack:{values:[]},draw:function(a){var b,c=a.context,d=a.lineWidth,e=a.shadowSize;c.save(),c.lineJoin="round",e&&(c.lineWidth=e/2,b=d/2+c.lineWidth/2,c.strokeStyle="rgba(0,0,0,0.1)",this.plot(a,b+e/2,!1),c.strokeStyle="rgba(0,0,0,0.2)",this.plot(a,b,!1)),c.lineWidth=d,c.strokeStyle=a.color,this.plot(a,0,!0),c.restore()},plot:function(a,b,c){function d(){!b&&a.fill&&w&&(e=o(w[0]),l.fillStyle=a.fillStyle,l.lineTo(f,v),l.lineTo(e,v),l.lineTo(e,p(w[1])),l.fill(),a.fillBorder&&l.stroke())}var e,f,g,h,i,j,k,l=a.context,m=a.width,n=a.height,o=a.xScale,p=a.yScale,q=a.data,r=a.stacked?this.stack:!1,s=q.length-1,t=null,u=null,v=p(0),w=null;if(!(1>s)){for(l.beginPath(),k=0;s>k;++k)null!==q[k][1]&&null!==q[k+1][1]?(e=o(q[k][0]),f=o(q[k+1][0]),null===w&&(w=q[k]),r?(i=r.values[q[k][0]]||0,j=r.values[q[k+1][0]]||r.values[q[k][0]]||0,g=p(q[k][1]+i),h=p(q[k+1][1]+j),c&&(r.values[q[k][0]]=q[k][1]+i,k==s-1&&(r.values[q[k+1][0]]=q[k+1][1]+j))):(g=p(q[k][1]),h=p(q[k+1][1])),g>n&&h>n||0>g&&0>h||0>e&&0>f||e>m&&f>m||((t!=e||u!=g+b)&&l.moveTo(e,g+b),t=f,u=h+b,a.steps?(l.lineTo(t+b/2,g+b),l.lineTo(t+b/2,u)):l.lineTo(t,u))):a.fill&&k>0&&q[k][1]&&(l.stroke(),d(),w=null,l.closePath(),l.beginPath());(!a.fill||a.fill&&!a.fillBorder)&&l.stroke(),d(),l.closePath()}},extendYRange:function(a,b,c,d){var e=a.options;if(c.stacked&&(!e.max&&0!==e.max||!e.min&&0!==e.min)){var f,g,h=a.max,i=a.min,j=d.positiveSums||{},k=d.negativeSums||{};for(g=0;g<b.length;g++)f=b[g][0]+"",b[g][1]>0?(j[f]=(j[f]||0)+b[g][1],h=Math.max(h,j[f])):(k[f]=(k[f]||0)+b[g][1],i=Math.min(i,k[f]));d.negativeSums=k,d.positiveSums=j,a.max=h,a.min=i}c.steps&&(this.hit=function(a){var b,c=a.data,d=a.args,e=a.yScale,f=d[0],g=c.length,h=d[1],i=a.xInverse(f.relX),j=f.relY;for(b=0;g-1>b;b++)if(i>=c[b][0]&&i<=c[b+1][0]){Math.abs(e(c[b][1])-j)<8&&(h.x=c[b][0],h.y=c[b][1],h.index=b,h.seriesIndex=a.index);break}},this.drawHit=function(a){var b,c=a.context,d=a.args,e=a.data,f=a.xScale,g=d.index,h=f(d.x),i=a.yScale(d.y);e.length-1>g&&(b=a.xScale(e[g+1][0]),c.save(),c.strokeStyle=a.color,c.lineWidth=a.lineWidth,c.beginPath(),c.moveTo(h,i),c.lineTo(b,i),c.stroke(),c.closePath(),c.restore())},this.clearHit=function(a){var b,c=a.context,d=a.args,e=a.data,f=a.xScale,g=a.lineWidth,h=d.index,i=f(d.x),j=a.yScale(d.y);e.length-1>h&&(b=a.xScale(e[h+1][0]),c.clearRect(i-g,j-g,b-i+2*g,2*g))})}}),Flotr.addType("bars",{options:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,fillOpacity:.4,horizontal:!1,stacked:!1,centered:!0,topPadding:.1,grouped:!1},stack:{positive:[],negative:[],_positive:[],_negative:[]},draw:function(a){var b=a.context;this.current+=1,b.save(),b.lineJoin="miter",b.lineWidth=a.lineWidth,b.strokeStyle=a.color,a.fill&&(b.fillStyle=a.fillStyle),this.plot(a),b.restore()},plot:function(a){var b,c,d,e,f,g,h=a.data,i=a.context,j=a.shadowSize;if(!(h.length<1))for(this.translate(i,a.horizontal),b=0;b<h.length;b++)c=this.getBarGeometry(h[b][0],h[b][1],a),null!==c&&(d=c.left,e=c.top,f=c.width,g=c.height,a.fill&&i.fillRect(d,e,f,g),j&&(i.save(),i.fillStyle="rgba(0,0,0,0.05)",i.fillRect(d+j,e+j,f,g),i.restore()),a.lineWidth&&i.strokeRect(d,e,f,g))},translate:function(a,b){b&&(a.rotate(-Math.PI/2),a.scale(-1,1))},getBarGeometry:function(a,b,c){var d,e,f,g,h,i=c.horizontal,j=c.barWidth,k=c.centered,l=c.stacked?this.stack:!1,m=c.lineWidth,n=k?j/2:0,o=i?c.yScale:c.xScale,p=i?c.xScale:c.yScale,q=i?b:a,r=i?a:b,s=0;return c.grouped&&(this.current/this.groups,q-=n,j/=this.groups,n=j/2,q=q+j*this.current-n),l&&(d=r>0?l.positive:l.negative,s=d[q]||s,d[q]=s+r),e=o(q-n),f=o(q+j-n),g=p(r+s),h=p(s),0>h&&(h=0),null===a||null===b?null:{x:q,y:r,xScale:o,yScale:p,top:g,left:Math.min(e,f)-m/2,width:Math.abs(f-e)-m,height:h-g}},hit:function(a){var b,c,d=a.data,e=a.args,f=e[0],g=e[1],h=a.xInverse(f.relX),i=a.yInverse(f.relY),j=this.getBarGeometry(h,i,a),k=j.width/2,l=j.left,m=j.y;for(c=d.length;c--;)b=this.getBarGeometry(d[c][0],d[c][1],a),(m>0&&m<b.y||0>m&&m>b.y)&&Math.abs(l-b.left)<k&&(g.x=d[c][0],g.y=d[c][1],g.index=c,g.seriesIndex=a.index)},drawHit:function(a){var b=a.context,c=a.args,d=this.getBarGeometry(c.x,c.y,a),e=d.left,f=d.top,g=d.width,h=d.height;b.save(),b.strokeStyle=a.color,b.lineWidth=a.lineWidth,this.translate(b,a.horizontal),b.beginPath(),b.moveTo(e,f+h),b.lineTo(e,f),b.lineTo(e+g,f),b.lineTo(e+g,f+h),a.fill&&(b.fillStyle=a.fillStyle,b.fill()),b.stroke(),b.closePath(),b.restore()},clearHit:function(a){var b=a.context,c=a.args,d=this.getBarGeometry(c.x,c.y,a),e=d.left,f=d.width,g=d.top,h=d.height,i=2*a.lineWidth;b.save(),this.translate(b,a.horizontal),b.clearRect(e-i,Math.min(g,g+h)-i,f+2*i,Math.abs(h)+2*i),b.restore()},extendXRange:function(a,b,c,d){this._extendRange(a,b,c,d),this.groups=this.groups+1||1,this.current=0},extendYRange:function(a,b,c,d){this._extendRange(a,b,c,d)},_extendRange:function(a,b,c){var d=a.options.max;if(!_.isNumber(d)&&!_.isString(d)){var e,f,g,h=a.min,i=a.max,j=c.horizontal,k=a.orientation,l=this.positiveSums||{},m=this.negativeSums||{};if((1==k&&!j||-1==k&&j)&&c.centered&&(i=Math.max(a.datamax+c.barWidth,i),h=Math.min(a.datamin-c.barWidth,h)),c.stacked&&(1==k&&j||-1==k&&!j))for(g=b.length;g--;)e=b[g][1==k?1:0]+"",f=b[g][1==k?0:1],f>0?(l[e]=(l[e]||0)+f,i=Math.max(i,l[e])):(m[e]=(m[e]||0)+f,h=Math.min(h,m[e]));(1==k&&j||-1==k&&!j)&&c.topPadding&&(a.max===a.datamax||c.stacked&&this.stackMax!==i)&&(i+=c.topPadding*(i-h)),this.stackMin=h,this.stackMax=i,this.negativeSums=m,this.positiveSums=l,a.max=i,a.min=h}}}),Flotr.addType("points",{options:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#FFFFFF",fillOpacity:1,hitRadius:null},draw:function(a){var b=a.context,c=(a.lineWidth,a.shadowSize);b.save(),c>0&&(b.lineWidth=c/2,b.strokeStyle="rgba(0,0,0,0.1)",this.plot(a,c/2+b.lineWidth/2),b.strokeStyle="rgba(0,0,0,0.2)",this.plot(a,b.lineWidth/2)),b.lineWidth=a.lineWidth,b.strokeStyle=a.color,a.fill&&(b.fillStyle=a.fillStyle),this.plot(a),b.restore()},plot:function(a,b){var c,d,e,f=a.data,g=a.context,h=a.xScale,i=a.yScale;for(c=f.length-1;c>-1;--c)e=f[c][1],null!==e&&(d=h(f[c][0]),e=i(e),0>d||d>a.width||0>e||e>a.height||(g.beginPath(),b?g.arc(d,e+b,a.radius,0,Math.PI,!1):(g.arc(d,e,a.radius,0,2*Math.PI,!0),a.fill&&g.fill()),g.stroke(),g.closePath()))}}),function(){function a(a){return a.which?1===a.which:0===a.button||1===a.button}function b(a,b){return Math.min(Math.max(0,a),b.plotWidth)}function c(a,b){return Math.min(Math.max(0,a),b.plotHeight)}var d=(Flotr.DOM,Flotr.EventAdapter),e=Flotr._;Flotr.addPlugin("selection",{options:{pinchOnly:null,mode:null,color:"#B6D9FF",fps:20},callbacks:{"flotr:mouseup":function(a){var b=this.options.selection,c=this.selection,d=this.getEventPosition(a);b&&b.mode&&(c.interval&&clearInterval(c.interval),this.multitouches?c.updateSelection():b.pinchOnly||c.setSelectionPos(c.selection.second,d),c.clearSelection(),c.selecting&&c.selectionIsSane()&&(c.drawSelection(),c.fireSelectEvent(),this.ignoreClick=!0))},"flotr:mousedown":function(b){var c=this.options.selection,d=this.selection,f=this.getEventPosition(b);c&&c.mode&&(!c.mode||!a(b)&&e.isUndefined(b.touches)||(c.pinchOnly||d.setSelectionPos(d.selection.first,f),d.interval&&clearInterval(d.interval),this.lastMousePos.pageX=null,d.selecting=!1,d.interval=setInterval(e.bind(d.updateSelection,this),1e3/c.fps)))},"flotr:destroy":function(){clearInterval(this.selection.interval)}},getArea:function(){{var a,b,c,d,e=this.selection.selection,f=this.axes;e.first,e.second}return a=f.x.p2d(e.first.x),b=f.x.p2d(e.second.x),c=f.y.p2d(e.first.y),d=f.y.p2d(e.second.y),{x1:Math.min(a,b),y1:Math.min(c,d),x2:Math.max(a,b),y2:Math.max(c,d),xfirst:a,xsecond:b,yfirst:c,ysecond:d}},selection:{first:{x:-1,y:-1},second:{x:-1,y:-1}},prevSelection:null,interval:null,fireSelectEvent:function(a){var b=this.selection.getArea();a=a||"select",b.selection=this.selection.selection,d.fire(this.el,"flotr:"+a,[b,this])},setSelection:function(a,d){var e=this.options,f=this.axes.x,g=this.axes.y,h=g.scale,i=f.scale,j=-1!=e.selection.mode.indexOf("x"),k=-1!=e.selection.mode.indexOf("y"),l=this.selection.selection;this.selection.clearSelection(),l.first.y=c(j&&!k?0:(g.max-a.y1)*h,this),l.second.y=c(j&&!k?this.plotHeight-1:(g.max-a.y2)*h,this),l.first.x=b(k&&!j?0:(a.x1-f.min)*i,this),l.second.x=b(k&&!j?this.plotWidth:(a.x2-f.min)*i,this),this.selection.drawSelection(),d||this.selection.fireSelectEvent()},setSelectionPos:function(a,d){var e=this.options.selection.mode,f=this.selection.selection;a.x=-1==e.indexOf("x")?a==f.first?0:this.plotWidth:b(d.relX,this),a.y=-1==e.indexOf("y")?a==f.first?0:this.plotHeight-1:c(d.relY,this)},drawSelection:function(){this.selection.fireSelectEvent("selecting");var a=this.selection.selection,b=this.octx,c=this.options,d=this.plotOffset,e=this.selection.prevSelection;if(!e||a.first.x!=e.first.x||a.first.y!=e.first.y||a.second.x!=e.second.x||a.second.y!=e.second.y){b.save(),b.strokeStyle=this.processColor(c.selection.color,{opacity:.8}),b.lineWidth=1,b.lineJoin="miter",b.fillStyle=this.processColor(c.selection.color,{opacity:.4}),this.selection.prevSelection={first:{x:a.first.x,y:a.first.y},second:{x:a.second.x,y:a.second.y}};var f=Math.min(a.first.x,a.second.x),g=Math.min(a.first.y,a.second.y),h=Math.abs(a.second.x-a.first.x),i=Math.abs(a.second.y-a.first.y);b.fillRect(f+d.left+.5,g+d.top+.5,h,i),b.strokeRect(f+d.left+.5,g+d.top+.5,h,i),b.restore()}},updateSelection:function(){if(this.lastMousePos.pageX){if(this.selection.selecting=!0,this.multitouches)this.selection.setSelectionPos(this.selection.selection.first,this.getEventPosition(this.multitouches[0])),this.selection.setSelectionPos(this.selection.selection.second,this.getEventPosition(this.multitouches[1]));else{if(this.options.selection.pinchOnly)return;this.selection.setSelectionPos(this.selection.selection.second,this.lastMousePos)}this.selection.clearSelection(),this.selection.selectionIsSane()&&this.selection.drawSelection()}},clearSelection:function(){if(this.selection.prevSelection){var a=this.selection.prevSelection,b=1,c=this.plotOffset,d=Math.min(a.first.x,a.second.x),e=Math.min(a.first.y,a.second.y),f=Math.abs(a.second.x-a.first.x),g=Math.abs(a.second.y-a.first.y);this.octx.clearRect(d+c.left-b+.5,e+c.top-b,f+2*b+.5,g+2*b+.5),this.selection.prevSelection=null}},selectionIsSane:function(){var a=this.selection.selection;return Math.abs(a.second.x-a.first.x)>=5||Math.abs(a.second.y-a.first.y)>=5}})}(),function(){var a=Flotr.DOM,b=Flotr._;Flotr.addPlugin("legend",{options:{show:!0,noColumns:1,labelFormatter:function(a){return a},labelBoxBorderColor:"#CCCCCC",labelBoxWidth:14,labelBoxHeight:10,labelBoxMargin:5,container:null,position:"nw",margin:5,backgroundColor:"#F0F0F0",backgroundOpacity:.85},callbacks:{"flotr:afterinit":function(){this.legend.insertLegend()}},insertLegend:function(){if(this.options.legend.show){var c,d,e,f=this.series,g=this.plotOffset,h=this.options,i=h.legend,j=[],k=!1,l=this.ctx,m=b.filter(f,function(a){return a.label&&!a.hide}).length,n=i.position,o=i.margin,p=i.backgroundOpacity;if(m){var q=i.labelBoxWidth,r=i.labelBoxHeight,s=i.labelBoxMargin,t=g.left+o,u=g.top+o,v=0,w={size:1.1*h.fontSize,color:h.grid.color};for(c=f.length-1;c>-1;--c)f[c].label&&!f[c].hide&&(d=i.labelFormatter(f[c].label),v=Math.max(v,this._text.measureText(d,w).width));var x=Math.round(q+3*s+v),y=Math.round(m*(s+r)+s);if(p||0===p||(p=.1),h.HtmlText||!this.textEnabled||i.container){for(c=0;c<f.length;++c)if(f[c].label&&!f[c].hide){c%i.noColumns===0&&(j.push(k?"</tr><tr>":"<tr>"),k=!0);var z=f[c],A=i.labelBoxWidth,B=i.labelBoxHeight;d=i.labelFormatter(z.label),e="background-color:"+(z.bars&&z.bars.show&&z.bars.fillColor&&z.bars.fill?z.bars.fillColor:z.color)+";",j.push('<td class="flotr-legend-color-box">','<div style="border:1px solid ',i.labelBoxBorderColor,';padding:1px">','<div style="width:',A-1,"px;height:",B-1,"px;border:1px solid ",f[c].color,'">','<div style="width:',A,"px;height:",B,"px;",e,'"></div>',"</div>","</div>","</td>",'<td class="flotr-legend-label">',d,"</td>")}if(k&&j.push("</tr>"),j.length>0){var C='<table style="font-size:smaller;color:'+h.grid.color+'">'+j.join("")+"</table>";if(i.container)a.empty(i.container),a.insert(i.container,C);else{var D={position:"absolute",zIndex:"2",border:"1px solid "+i.labelBoxBorderColor};"n"==n.charAt(0)?(D.top=o+g.top+"px",D.bottom="auto"):"c"==n.charAt(0)?(D.top=o+(this.plotHeight-y)/2+"px",D.bottom="auto"):"s"==n.charAt(0)&&(D.bottom=o+g.bottom+"px",D.top="auto"),"e"==n.charAt(1)?(D.right=o+g.right+"px",D.left="auto"):"w"==n.charAt(1)&&(D.left=o+g.left+"px",D.right="auto");var E=a.create("div");if(E.className="flotr-legend",a.setStyles(E,D),a.insert(E,C),a.insert(this.el,E),!p)return;var F=i.backgroundColor||h.grid.backgroundColor||"#ffffff";b.extend(D,a.size(E),{backgroundColor:F,zIndex:"",border:""}),D.width+="px",D.height+="px",E=a.create("div"),E.className="flotr-legend-bg",a.setStyles(E,D),a.opacity(E,p),a.insert(E," "),a.insert(this.el,E)}}}else{"s"==n.charAt(0)&&(u=g.top+this.plotHeight-(o+y)),"c"==n.charAt(0)&&(u=g.top+this.plotHeight/2-(o+y/2)),"e"==n.charAt(1)&&(t=g.left+this.plotWidth-(o+x)),e=this.processColor(i.backgroundColor,{opacity:p}),l.fillStyle=e,l.fillRect(t,u,x,y),l.strokeStyle=i.labelBoxBorderColor,l.strokeRect(Flotr.toPixel(t),Flotr.toPixel(u),x,y);var G=t+s,H=u+s;for(c=0;c<f.length;c++)f[c].label&&!f[c].hide&&(d=i.labelFormatter(f[c].label),l.fillStyle=f[c].color,l.fillRect(G,H,q-1,r-1),l.strokeStyle=i.labelBoxBorderColor,l.lineWidth=1,l.strokeRect(Math.ceil(G)-1.5,Math.ceil(H)-1.5,q+2,r+2),Flotr.drawText(l,d,G+q+s,H+r,w),H+=r+s)}}}}})}(),function(){var a=Flotr.DOM,b=Flotr._,c=Flotr,d="opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;";Flotr.addPlugin("hit",{callbacks:{"flotr:mousemove":function(a,b){this.hit.track(b)},"flotr:click":function(a){var c=this.hit.track(a);b.defaults(a,c)},"flotr:mouseout":function(){this.hit.clearHit()},"flotr:destroy":function(){this.mouseTrack=null}},track:function(a){return this.options.mouse.track||b.any(this.series,function(a){return a.mouse&&a.mouse.track})?this.hit.hit(a):void 0},executeOnType:function(a,d,e){function f(a,f){b.each(b.keys(c.graphTypes),function(b){a[b]&&a[b].show&&this[b][d]&&(g=this.getOptions(a,b),g.fill=!!a.mouse.fillColor,g.fillStyle=this.processColor(a.mouse.fillColor||"#ffffff",{opacity:a.mouse.fillOpacity}),g.color=a.mouse.lineColor,g.context=this.octx,g.index=f,e&&(g.args=e),this[b][d].call(this[b],g),h=!0)},this)}var g,h=!1;return b.isArray(a)||(a=[a]),b.each(a,f,this),h},drawHit:function(a){var b=this.octx,c=a.series;if(c.mouse.lineColor){if(b.save(),b.lineWidth=c.points?c.points.lineWidth:1,b.strokeStyle=c.mouse.lineColor,b.fillStyle=this.processColor(c.mouse.fillColor||"#ffffff",{opacity:c.mouse.fillOpacity}),b.translate(this.plotOffset.left,this.plotOffset.top),!this.hit.executeOnType(c,"drawHit",a)){var d=a.xaxis,e=a.yaxis;b.beginPath(),b.arc(d.d2p(a.x),e.d2p(a.y),c.points.hitRadius||c.points.radius||c.mouse.radius,0,2*Math.PI,!0),b.fill(),b.stroke(),b.closePath()}b.restore(),this.clip(b)}this.prevHit=a},clearHit:function(){var b=this.prevHit,c=this.octx,d=this.plotOffset;if(c.save(),c.translate(d.left,d.top),b){if(!this.hit.executeOnType(b.series,"clearHit",this.prevHit)){var e=b.series,f=e.points?e.points.lineWidth:1;offset=(e.points.hitRadius||e.points.radius||e.mouse.radius)+f,c.clearRect(b.xaxis.d2p(b.x)-offset,b.yaxis.d2p(b.y)-offset,2*offset,2*offset)}a.hide(this.mouseTrack),this.prevHit=null}c.restore()},hit:function(a){var c,d,e,f,g,h,i,j=this.options,k=this.prevHit;if(0!==this.series.length)return i={relX:a.relX,relY:a.relY,absX:a.absX,absY:a.absY},j.mouse.trackY&&!j.mouse.trackAll&&this.hit.executeOnType(this.series,"hit",[a,i])&&!b.isUndefined(i.seriesIndex)?(f=this.series[i.seriesIndex],i.series=f,i.mouse=f.mouse,i.xaxis=f.xaxis,i.yaxis=f.yaxis):(c=this.hit.closest(a),c&&(c=j.mouse.trackY?c.point:c.x,e=c.seriesIndex,f=this.series[e],g=f.xaxis,h=f.yaxis,d=2*f.mouse.sensibility,(j.mouse.trackAll||c.distanceX<d/g.scale&&(!j.mouse.trackY||c.distanceY<d/h.scale))&&(i.series=f,i.xaxis=f.xaxis,i.yaxis=f.yaxis,i.mouse=f.mouse,i.x=c.x,i.y=c.y,i.dist=c.distance,i.index=c.dataIndex,i.seriesIndex=e))),k&&k.index===i.index&&k.seriesIndex===i.seriesIndex||(this.hit.clearHit(),i.series&&i.mouse&&i.mouse.track&&(this.hit.drawMouseTrack(i),this.hit.drawHit(i),Flotr.EventAdapter.fire(this.el,"flotr:hit",[i,this]))),i},closest:function(a){function b(a){a.distance=e,a.distanceX=f,a.distanceY=g,a.seriesIndex=l,a.dataIndex=m,a.x=j,a.y=k,u=!0}var c,d,e,f,g,h,i,j,k,l,m,n=this.series,o=(this.options,a.relX),p=a.relY,q=Number.MAX_VALUE,r=Number.MAX_VALUE,s={},t={},u=!1;for(l=0;l<n.length;l++)for(c=n[l],d=c.data,h=c.xaxis.p2d(o),i=c.yaxis.p2d(p),m=d.length;m--;)j=d[m][0],k=d[m][1],null!==j&&null!==k&&(j<c.xaxis.min||j>c.xaxis.max||(f=Math.abs(j-h),g=Math.abs(k-i),e=f*f+g*g,q>e&&(q=e,b(s)),r>f&&(r=f,b(t))));return u?{point:s,x:t}:!1},drawMouseTrack:function(b){{var c="",e=b.series,f=b.mouse.position,g=b.mouse.margin,h=b.x,i=b.y,j=d,k=this.mouseTrack,l=this.plotOffset,m=l.left,n=l.right,o=l.bottom,p=l.top,q=b.mouse.trackDecimals;this.options}if(k||(k=a.node('<div class="flotr-mouse-value"></div>'),this.mouseTrack=k,a.insert(this.el,k)),b.mouse.relative)if(e.pie&&e.pie.show){var r={x:this.plotWidth/2,y:this.plotHeight/2},s=Math.min(this.canvasWidth,this.canvasHeight)*e.pie.sizeRatio/2,t=b.sAngle<b.eAngle?(b.sAngle+b.eAngle)/2:(b.sAngle+b.eAngle+2*Math.PI)/2;c+="bottom:"+(g-p-r.y-Math.sin(t)*s/2+this.canvasHeight)+"px;top:auto;",c+="left:"+(g+m+r.x+Math.cos(t)*s/2)+"px;right:auto;"}else c+=/n/.test(f)?"bottom:"+(g-p-b.yaxis.d2p(b.y)+this.canvasHeight)+"px;top:auto;":"top:"+(g+p+b.yaxis.d2p(b.y))+"px;bottom:auto;",c+=/w/.test(f)?"right:"+(g-m-b.xaxis.d2p(b.x)+this.canvasWidth)+"px;left:auto;":"left:"+(g+m+b.xaxis.d2p(b.x))+"px;right:auto;";else"n"==f.charAt(0)?c+="top:"+(g+p)+"px;bottom:auto;":"s"==f.charAt(0)&&(c+="bottom:"+(g+o)+"px;top:auto;"),"e"==f.charAt(1)?c+="right:"+(g+n)+"px;left:auto;":"w"==f.charAt(1)&&(c+="left:"+(g+m)+"px;right:auto;");j+=c,k.style.cssText=j,(!q||0>q)&&(q=0),h&&h.toFixed&&(h=h.toFixed(q)),i&&i.toFixed&&(i=i.toFixed(q)),k.innerHTML=b.mouse.trackFormatter({x:h,y:i,series:b.series,index:b.index,nearest:b,fraction:b.fraction}),a.show(k),b.mouse.relative&&(/[ew]/.test(f)?/[ns]/.test(f)||(k.style.top=p+b.yaxis.d2p(b.y)-a.size(k).height/2+"px"):k.style.left=m+b.xaxis.d2p(b.x)-a.size(k).width/2+"px")}})}(),function(){var a=Flotr.DOM;Flotr.addPlugin("labels",{callbacks:{"flotr:afterdraw":function(){this.labels.draw()}},draw:function(){function b(a,b,c){{var d,f=c?b.minorTicks:b.ticks,h=1===b.orientation;1===b.n}for(d={color:b.options.color||o.grid.color,angle:Flotr.toRad(b.options.labelsAngle),textBaseline:"middle"},l=0;l<f.length&&(c?b.options.showMinorLabels:b.options.showLabels);++l)e=f[l],e.label+="",e.label&&e.label.length&&(x=Math.cos(l*i+j)*g,y=Math.sin(l*i+j)*g,d.textAlign=h?Math.abs(x)<.1?"center":x<0?"right":"left":"left",Flotr.drawText(p,e.label,h?x:3,h?y:-(b.ticks[l].v/b.max)*(g-o.fontSize),d))}function c(a,b,c,d){function f(a){return a.options.showLabels&&a.used}function g(a,b,c,d){return a.plotOffset.left+(b?d:c?-o.grid.labelMargin:o.grid.labelMargin+a.plotWidth)}function h(a,b,c,d){return a.plotOffset.top+(b?o.grid.labelMargin:d)+(b&&c?a.plotHeight:0)}var i,j,k=1===b.orientation,m=1===b.n;for(i={color:b.options.color||o.grid.color,textAlign:c,textBaseline:d,angle:Flotr.toRad(b.options.labelsAngle)},i=Flotr.getBestTextAlign(i.angle,i),l=0;l<b.ticks.length&&f(b);++l)e=b.ticks[l],e.label&&e.label.length&&(j=b.d2p(e.v),0>j||j>(k?a.plotWidth:a.plotHeight)||(Flotr.drawText(p,e.label,g(a,k,m,j),h(a,k,m,j),i),k||m||(p.save(),p.strokeStyle=i.color,p.beginPath(),p.moveTo(a.plotOffset.left+a.plotWidth-8,a.plotOffset.top+b.d2p(e.v)),p.lineTo(a.plotOffset.left+a.plotWidth,a.plotOffset.top+b.d2p(e.v)),p.stroke(),p.restore())))}function d(a,b){var c,d,g=1===b.orientation,h=1===b.n,i="",j=a.plotOffset;if(g||h||(p.save(),p.strokeStyle=b.options.color||o.grid.color,p.beginPath()),b.options.showLabels&&(h?!0:b.used))for(l=0;l<b.ticks.length;++l)e=b.ticks[l],!e.label||!e.label.length||(g?j.left:j.top)+b.d2p(e.v)<0||(g?j.left:j.top)+b.d2p(e.v)>(g?a.canvasWidth:a.canvasHeight)||(d=j.top+(g?(h?1:-1)*(a.plotHeight+o.grid.labelMargin):b.d2p(e.v)-b.maxLabel.height/2),c=g?j.left+b.d2p(e.v)-f/2:0,i="",0===l?i=" first":l===b.ticks.length-1&&(i=" last"),i+=g?" flotr-grid-label-x":" flotr-grid-label-y",m+=['<div style="position:absolute; text-align:'+(g?"center":"right")+"; ","top:"+d+"px; ",(g||h?"left:":"right:")+c+"px; ","width:"+(g?f:(h?j.left:j.right)-o.grid.labelMargin)+"px; ",b.options.color?"color:"+b.options.color+"; ":" ",'" class="flotr-grid-label'+i+'">'+e.label+"</div>"].join(" "),g||h||(p.moveTo(j.left+a.plotWidth-8,j.top+b.d2p(e.v)),p.lineTo(j.left+a.plotWidth,j.top+b.d2p(e.v))))}{var e,f,g,h,i,j,k,l,m="",n=0,o=this.options,p=this.ctx,q=this.axes;({size:o.fontSize})}for(l=0;l<q.x.ticks.length;++l)q.x.ticks[l].label&&++n;f=this.plotWidth/n,o.grid.circular&&(p.save(),p.translate(this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+this.plotHeight/2),g=this.plotHeight*o.radar.radiusRatio/2+o.fontSize,h=this.axes.x.ticks.length,i=2*(Math.PI/h),j=-Math.PI/2,b(this,q.x,!1),b(this,q.x,!0),b(this,q.y,!1),b(this,q.y,!0),p.restore()),!o.HtmlText&&this.textEnabled?(c(this,q.x,"center","top"),c(this,q.x2,"center","bottom"),c(this,q.y,"right","middle"),c(this,q.y2,"left","middle")):(q.x.options.showLabels||q.x2.options.showLabels||q.y.options.showLabels||q.y2.options.showLabels)&&!o.grid.circular&&(m="",d(this,q.x),d(this,q.x2),d(this,q.y),d(this,q.y2),p.stroke(),p.restore(),k=a.create("div"),a.setStyles(k,{fontSize:"smaller",color:o.grid.color}),k.className="flotr-labels",a.insert(this.el,k),a.insert(k,m))}})}(),function(){var a=Flotr.DOM,b=Flotr._;Flotr.addPlugin("legend",{options:{show:!0,noColumns:1,labelFormatter:function(a){return a},labelBoxBorderColor:"#CCCCCC",labelBoxWidth:14,labelBoxHeight:10,labelBoxMargin:5,container:null,position:"nw",margin:5,backgroundColor:"#F0F0F0",backgroundOpacity:.85},callbacks:{"flotr:afterinit":function(){this.legend.insertLegend()}},insertLegend:function(){if(this.options.legend.show){var c,d,e,f=this.series,g=this.plotOffset,h=this.options,i=h.legend,j=[],k=!1,l=this.ctx,m=b.filter(f,function(a){return a.label&&!a.hide}).length,n=i.position,o=i.margin,p=i.backgroundOpacity;if(m){var q=i.labelBoxWidth,r=i.labelBoxHeight,s=i.labelBoxMargin,t=g.left+o,u=g.top+o,v=0,w={size:1.1*h.fontSize,color:h.grid.color};for(c=f.length-1;c>-1;--c)f[c].label&&!f[c].hide&&(d=i.labelFormatter(f[c].label),v=Math.max(v,this._text.measureText(d,w).width));var x=Math.round(q+3*s+v),y=Math.round(m*(s+r)+s);if(p||0===p||(p=.1),h.HtmlText||!this.textEnabled||i.container){for(c=0;c<f.length;++c)if(f[c].label&&!f[c].hide){c%i.noColumns===0&&(j.push(k?"</tr><tr>":"<tr>"),k=!0);var z=f[c],A=i.labelBoxWidth,B=i.labelBoxHeight;d=i.labelFormatter(z.label),e="background-color:"+(z.bars&&z.bars.show&&z.bars.fillColor&&z.bars.fill?z.bars.fillColor:z.color)+";",j.push('<td class="flotr-legend-color-box">','<div style="border:1px solid ',i.labelBoxBorderColor,';padding:1px">','<div style="width:',A-1,"px;height:",B-1,"px;border:1px solid ",f[c].color,'">','<div style="width:',A,"px;height:",B,"px;",e,'"></div>',"</div>","</div>","</td>",'<td class="flotr-legend-label">',d,"</td>")}if(k&&j.push("</tr>"),j.length>0){var C='<table style="font-size:smaller;color:'+h.grid.color+'">'+j.join("")+"</table>";if(i.container)a.empty(i.container),a.insert(i.container,C);else{var D={position:"absolute",zIndex:"2",border:"1px solid "+i.labelBoxBorderColor};"n"==n.charAt(0)?(D.top=o+g.top+"px",D.bottom="auto"):"c"==n.charAt(0)?(D.top=o+(this.plotHeight-y)/2+"px",D.bottom="auto"):"s"==n.charAt(0)&&(D.bottom=o+g.bottom+"px",D.top="auto"),"e"==n.charAt(1)?(D.right=o+g.right+"px",D.left="auto"):"w"==n.charAt(1)&&(D.left=o+g.left+"px",D.right="auto");var E=a.create("div");if(E.className="flotr-legend",a.setStyles(E,D),a.insert(E,C),a.insert(this.el,E),!p)return;var F=i.backgroundColor||h.grid.backgroundColor||"#ffffff";b.extend(D,a.size(E),{backgroundColor:F,zIndex:"",border:""}),D.width+="px",D.height+="px",E=a.create("div"),E.className="flotr-legend-bg",a.setStyles(E,D),a.opacity(E,p),a.insert(E," "),a.insert(this.el,E)}}}else{"s"==n.charAt(0)&&(u=g.top+this.plotHeight-(o+y)),"c"==n.charAt(0)&&(u=g.top+this.plotHeight/2-(o+y/2)),"e"==n.charAt(1)&&(t=g.left+this.plotWidth-(o+x)),e=this.processColor(i.backgroundColor,{opacity:p}),l.fillStyle=e,l.fillRect(t,u,x,y),l.strokeStyle=i.labelBoxBorderColor,l.strokeRect(Flotr.toPixel(t),Flotr.toPixel(u),x,y);var G=t+s,H=u+s;for(c=0;c<f.length;c++)f[c].label&&!f[c].hide&&(d=i.labelFormatter(f[c].label),l.fillStyle=f[c].color,l.fillRect(G,H,q-1,r-1),l.strokeStyle=i.labelBoxBorderColor,l.lineWidth=1,l.strokeRect(Math.ceil(G)-1.5,Math.ceil(H)-1.5,q+2,r+2),Flotr.drawText(l,d,G+q+s,H+r,w),H+=r+s)}}}}})}(),function(){var a=Flotr.DOM;Flotr.addPlugin("titles",{callbacks:{"flotr:afterdraw":function(){this.titles.drawTitles()}},drawTitles:function(){var b,c=this.options,d=c.grid.labelMargin,e=this.ctx,f=this.axes;if(!c.HtmlText&&this.textEnabled){var g={size:c.fontSize,color:c.grid.color,textAlign:"center"};c.subtitle&&Flotr.drawText(e,c.subtitle,this.plotOffset.left+this.plotWidth/2,this.titleHeight+this.subtitleHeight-2,g),g.weight=1.5,g.size*=1.5,c.title&&Flotr.drawText(e,c.title,this.plotOffset.left+this.plotWidth/2,this.titleHeight-2,g),g.weight=1.8,g.size*=.8,f.x.options.title&&f.x.used&&(g.textAlign=f.x.options.titleAlign||"center",g.textBaseline="top",g.angle=Flotr.toRad(f.x.options.titleAngle),g=Flotr.getBestTextAlign(g.angle,g),Flotr.drawText(e,f.x.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+f.x.maxLabel.height+this.plotHeight+2*d,g)),f.x2.options.title&&f.x2.used&&(g.textAlign=f.x2.options.titleAlign||"center",g.textBaseline="bottom",g.angle=Flotr.toRad(f.x2.options.titleAngle),g=Flotr.getBestTextAlign(g.angle,g),Flotr.drawText(e,f.x2.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top-f.x2.maxLabel.height-2*d,g)),f.y.options.title&&f.y.used&&(g.textAlign=f.y.options.titleAlign||"right",g.textBaseline="middle",g.angle=Flotr.toRad(f.y.options.titleAngle),g=Flotr.getBestTextAlign(g.angle,g),Flotr.drawText(e,f.y.options.title,this.plotOffset.left-f.y.maxLabel.width-2*d,this.plotOffset.top+this.plotHeight/2,g)),f.y2.options.title&&f.y2.used&&(g.textAlign=f.y2.options.titleAlign||"left",g.textBaseline="middle",g.angle=Flotr.toRad(f.y2.options.titleAngle),g=Flotr.getBestTextAlign(g.angle,g),Flotr.drawText(e,f.y2.options.title,this.plotOffset.left+this.plotWidth+f.y2.maxLabel.width+2*d,this.plotOffset.top+this.plotHeight/2,g))
}else{b=[],c.title&&b.push('<div style="position:absolute;top:0;left:',this.plotOffset.left,"px;font-size:1em;font-weight:bold;text-align:center;width:",this.plotWidth,'px;" class="flotr-title">',c.title,"</div>"),c.subtitle&&b.push('<div style="position:absolute;top:',this.titleHeight,"px;left:",this.plotOffset.left,"px;font-size:smaller;text-align:center;width:",this.plotWidth,'px;" class="flotr-subtitle">',c.subtitle,"</div>"),b.push("</div>"),b.push('<div class="flotr-axis-title" style="font-weight:bold;">'),f.x.options.title&&f.x.used&&b.push('<div style="position:absolute;top:',this.plotOffset.top+this.plotHeight+c.grid.labelMargin+f.x.titleSize.height,"px;left:",this.plotOffset.left,"px;width:",this.plotWidth,"px;text-align:",f.x.options.titleAlign,';" class="flotr-axis-title flotr-axis-title-x1">',f.x.options.title,"</div>"),f.x2.options.title&&f.x2.used&&b.push('<div style="position:absolute;top:0;left:',this.plotOffset.left,"px;width:",this.plotWidth,"px;text-align:",f.x2.options.titleAlign,';" class="flotr-axis-title flotr-axis-title-x2">',f.x2.options.title,"</div>"),f.y.options.title&&f.y.used&&b.push('<div style="position:absolute;top:',this.plotOffset.top+this.plotHeight/2-f.y.titleSize.height/2,"px;left:0;text-align:",f.y.options.titleAlign,';" class="flotr-axis-title flotr-axis-title-y1">',f.y.options.title,"</div>"),f.y2.options.title&&f.y2.used&&b.push('<div style="position:absolute;top:',this.plotOffset.top+this.plotHeight/2-f.y.titleSize.height/2,"px;right:0;text-align:",f.y2.options.titleAlign,';" class="flotr-axis-title flotr-axis-title-y2">',f.y2.options.title,"</div>"),b=b.join("");var h=a.create("div");a.setStyles({color:c.grid.color}),h.className="flotr-titles",a.insert(this.el,h),a.insert(h,b)}}})}(),function(){function a(){var a,b,c,d,e=this.options,f=this.handles,g=this.el;!e.selection.mode||!e.handles.show||"ontouchstart"in g||(f.initialized=!0,d=k.node('<div class="flotr-handles"></div>'),e=e.handles,e.drag&&(c=k.node('<div class="flotr-handles-handle flotr-handles-drag flotr-handles-right"></div>'),b=k.node('<div class="flotr-handles-handle flotr-handles-drag flotr-handles-left"></div>'),k.insert(d,c),k.insert(d,b),k.hide(b),k.hide(c),f.left=b,f.right=c,this.observe(b,"mousedown",function(){f.moveHandler=h}),this.observe(c,"mousedown",function(){f.moveHandler=i})),e.scroll&&(a=k.node('<div class="flotr-handles-handle flotr-handles-scroll"></div>'),k.insert(d,a),k.hide(a),f.scroll=a,this.observe(a,"mousedown",function(){f.moveHandler=j})),this.observe(document,"mouseup",function(){f.moveHandler=null}),k.insert(g,d))}function b(a){if(this.handles.initialized){var b=this.handles,e=this.options.handles,f=b.left,g=b.right,h=b.scroll;e&&(e.drag&&(c(this,f,a.x1),c(this,g,a.x2)),e.scroll&&d(this,h,a.x1,a.x2))}}function c(a,b,c){k.show(b);var d=k.size(b),e=Math.round(a.axes.x.d2p(c)-d.width/2),f=(a.plotHeight-d.height)/2;k.setStyles(b,{left:e+"px",top:f+"px"})}function d(a,b,c,d){k.show(b);var e=k.size(b),f=Math.round(a.axes.x.d2p(c)),g=a.plotHeight-e.height/2,h=a.axes.x.d2p(d)-a.axes.x.d2p(c);k.setStyles(b,{left:f+"px",top:g+"px",width:h+"px"})}function e(){if(this.handles.initialized){var a=this.handles;a&&(k.hide(a.left),k.hide(a.right),k.hide(a.scroll))}}function f(a,b){if(this.handles.initialized&&this.handles.moveHandler){var c=b.x-this.lastMousePos.x,d=(this.selection.selection,this.selection.getArea()),e=this.handles;e.moveHandler(d,c),g(d,e),this.selection.setSelection(d)}}function g(a,b){var c=b.moveHandler;a.x1>a.x2&&(c==h?c=i:c==i&&(c=h),b.moveHandler=c)}function h(a,b){a.x1+=b}function i(a,b){a.x2+=b}function j(a,b){a.x1+=b,a.x2+=b}var k=Flotr.DOM;Flotr.addPlugin("handles",{options:{show:!1,drag:!0,scroll:!0},callbacks:{"flotr:afterinit":a,"flotr:select":b,"flotr:mousedown":e,"flotr:mousemove":f}})}(),!function(a,b){"function"==typeof define?define(b):"undefined"!=typeof module?module.exports=b():this[a]=b()}("bonzo",function(){function a(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function b(a,b,c){for(var d=0,e=a.length;e>d;d++)b.call(c||a[d],a[d],d,a);return a}function c(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function d(a){return a&&a.nodeName&&1==a.nodeType}function e(a,b,c,d){for(d=0,j=a.length;d<j;++d)if(b.call(c,a[d],d,a))return!0;return!1}function f(a,c,d){var e=0,f=c||this,g=[],h=w&&"string"==typeof a&&"<"!=a.charAt(0)?function(b){return(b=w(a))&&(b.selected=1)&&b}():a;return b(m(h),function(a){b(f,function(b){var c=!b[v]||b[v]&&!b[v][v]?function(){var a=b.cloneNode(!0);return f.$&&f.cloneEvents&&f.$(a).cloneEvents(b),a}():b;d(a,c),g[e]=c,e++})},this),b(g,function(a,b){f[b]=a}),f.length=e,f}function g(a,b,c){var d=q(a),e=d.css("position"),f=d.offset(),g="relative",h=e==g,i=[parseInt(d.css("left"),10),parseInt(d.css("top"),10)];"static"==e&&(d.css("position",g),e=g),isNaN(i[0])&&(i[0]=h?0:a.offsetLeft),isNaN(i[1])&&(i[1]=h?0:a.offsetTop),null!=b&&(a.style.left=b-f.left+i[0]+G),null!=c&&(a.style.top=c-f.top+i[1]+G)}function h(b,c){return a(c).test(b.className)}function i(a,b){a.className=M(a.className+" "+b)}function k(b,c){b.className=M(b.className.replace(a(c)," "))}function l(a){if(this.length=0,a){a="string"==typeof a||a.nodeType||"undefined"==typeof a.length?[a]:a,this.length=a.length;for(var b=0;b<a.length;b++)this[b]=a[b]}}function m(a){return"string"==typeof a?q.create(a):d(a)?[a]:a}function n(a,b,c){var d=this[0];return null==a&&null==b?(o(d)?p():{x:d.scrollLeft,y:d.scrollTop})[c]:(o(d)?s.scrollTo(a,b):(null!=a&&(d.scrollLeft=a),null!=b&&(d.scrollTop=b)),this)}function o(a){return a===s||/^(?:body|html)$/i.test(a.tagName)}function p(){return{x:s.pageXOffset||u.scrollLeft,y:s.pageYOffset||u.scrollTop}}function q(a,b){return new l(a,b)}var r=this,s=window,t=s.document,u=t.documentElement,v="parentNode",w=null,x=/^checked|value|selected$/,y=/select|fieldset|table|tbody|tfoot|td|tr|colgroup/i,z="table",A={thead:z,tbody:z,tfoot:z,tr:"tbody",th:"tr",td:"tr",fieldset:"form",option:"select"},B=/^checked|selected$/,C=/msie/i.test(navigator.userAgent),D=[],E=0,F=/^-?[\d\.]+$/,G="px",H="setAttribute",I="getAttribute",J=/(^\s*|\s*$)/g,K={lineHeight:1,zoom:1,zIndex:1,opacity:1},L=function(){var a,b=["webkitTransform","MozTransform","OTransform","msTransform","Transform"];for(a=0;a<b.length;a++)if(b[a]in t.createElement("a").style)return b[a]}(),M=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(J,"")},N=t.defaultView&&t.defaultView.getComputedStyle?function(a,b){b="transform"==b?L:b,b="transform-origin"==b?L+"Origin":b;var d=null;"float"==b&&(b="cssFloat");var e=t.defaultView.getComputedStyle(a,"");return e&&(d=e[c(b)]),a.style[b]||d}:C&&u.currentStyle?function(a,b){if(b=c(b),b="float"==b?"styleFloat":b,"opacity"==b){var d=100;try{d=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{d=a.filters("alpha").opacity}catch(f){}}return d/100}var g=a.currentStyle?a.currentStyle[b]:null;return a.style[b]||g}:function(a,b){return a.style[c(b)]};l.prototype={get:function(a){return this[a]},each:function(a,c){return b(this,a,c)},map:function(a,b){var c,d,e=[];for(d=0;d<this.length;d++)c=a.call(this,this[d],d),b?b(c)&&e.push(c):e.push(c);return e},first:function(){return q(this[0])},last:function(){return q(this[this.length-1])},html:function(a,c){function d(c){for(;c.firstChild;)c.removeChild(c.firstChild);b(m(a),function(a){c.appendChild(a)})}var e,f=c?null===u.textContent?"innerText":"textContent":"innerHTML";return"undefined"!=typeof a?this.each(function(b){(e=b.tagName.match(y))?d(b,e[0]):b[f]=a}):this[0]?this[0][f]:""},text:function(a){return this.html(a,1)},addClass:function(a){return this.each(function(b){h(b,a)||i(b,a)})},removeClass:function(a){return this.each(function(b){h(b,a)&&k(b,a)})},hasClass:function(a){return e(this,function(b){return h(b,a)})},toggleClass:function(a,b){return this.each(function(c){"undefined"!=typeof b?b?i(c,a):k(c,a):h(c,a)?k(c,a):i(c,a)})},show:function(a){return this.each(function(b){b.style.display=a||""})},hide:function(){return this.each(function(a){a.style.display="none"})},append:function(a){return this.each(function(c){b(m(a),function(a){c.appendChild(a)})})},prepend:function(a){return this.each(function(c){var d=c.firstChild;b(m(a),function(a){c.insertBefore(a,d)})})},appendTo:function(a,b){return f.call(this,a,b,function(a,b){a.appendChild(b)})},prependTo:function(a,b){return f.call(this,a,b,function(a,b){a.insertBefore(b,a.firstChild)})},next:function(){return this.related("nextSibling")},previous:function(){return this.related("previousSibling")},related:function(a){return this.map(function(b){for(b=b[a];b&&1!==b.nodeType;)b=b[a];return b||0},function(a){return a})},before:function(a){return this.each(function(c){b(q.create(a),function(a){c[v].insertBefore(a,c)})})},after:function(a){return this.each(function(c){b(q.create(a),function(a){c[v].insertBefore(a,c.nextSibling)})})},insertBefore:function(a,b){return f.call(this,a,b,function(a,b){a[v].insertBefore(b,a)})},insertAfter:function(a,b){return f.call(this,a,b,function(a,b){var c=a.nextSibling;c?a[v].insertBefore(b,c):a[v].appendChild(b)})},css:function(a,b,d){function e(a,b,d){for(var e in f)f.hasOwnProperty(e)&&(d=f[e],(b=c(e))&&F.test(d)&&!(b in K)&&(d+=G),b="transform"==b?L:b,b="transformOrigin"==b?L+"Origin":b,a.style[b]=d)}if(void 0===b&&"string"==typeof a)return b=this[0],b?b==t||b==s?(d=b==t?q.doc():q.viewport(),"width"==a?d.width:"height"==a?d.height:""):N(b,a):null;var f=a;return"string"==typeof a&&(f={},f[a]=b),C&&f.opacity&&(f.filter="alpha(opacity="+100*f.opacity+")",f.zoom=a.zoom||1,delete f.opacity),(b=f["float"])&&(C?f.styleFloat=b:f.cssFloat=b,delete f["float"]),this.each(e)},offset:function(a,b){if("number"==typeof a||"number"==typeof b)return this.each(function(c){g(c,a,b)});for(var c=this[0],d=c.offsetWidth,e=c.offsetHeight,f=c.offsetTop,h=c.offsetLeft;c=c.offsetParent;)f+=c.offsetTop,h+=c.offsetLeft;return{top:f,left:h,height:e,width:d}},attr:function(a,b){var c=this[0];if("string"==typeof a||a instanceof String)return"undefined"==typeof b?x.test(a)?B.test(a)&&"string"==typeof c[a]?!0:c[a]:c[I](a):this.each(function(c){x.test(a)?c[a]=b:c[H](a,b)});for(var d in a)a.hasOwnProperty(d)&&this.attr(d,a[d]);return this},val:function(a){return"string"==typeof a?this.attr("value",a):this[0].value},removeAttr:function(a){return this.each(function(b){B.test(a)?b[a]=!1:b.removeAttribute(a)})},data:function(a,b){var c=this[0];if("undefined"==typeof b){c[I]("data-node-uid")||c[H]("data-node-uid",++E);var d=c[I]("data-node-uid");return D[d]||(D[d]={}),D[d][a]}return this.each(function(c){c[I]("data-node-uid")||c[H]("data-node-uid",++E);var d=c[I]("data-node-uid"),e=D[d]||(D[d]={});e[a]=b})},remove:function(){return this.each(function(a){a[v]&&a[v].removeChild(a)})},empty:function(){return this.each(function(a){for(;a.firstChild;)a.removeChild(a.firstChild)})},detach:function(){return this.map(function(a){return a[v].removeChild(a)})},scrollTop:function(a){return n.call(this,null,a,"y")},scrollLeft:function(a){return n.call(this,a,null,"x")},toggle:function(a){return this.each(function(a){a.style.display=a.offsetWidth||a.offsetHeight?"none":"block"}),a&&a(),this}},q.setQueryEngine=function(a){w=a,delete q.setQueryEngine},q.aug=function(a,b){for(var c in a)a.hasOwnProperty(c)&&((b||l.prototype)[c]=a[c])},q.create=function(a){return"string"==typeof a?function(){var b=/^<([^\s>]+)/.exec(a),c=t.createElement(b&&A[b[1].toLowerCase()]||"div"),d=[];c.innerHTML=a;c.childNodes;for(c=c.firstChild,d.push(c);c=c.nextSibling;)1==c.nodeType&&d.push(c);return d}():d(a)?[a.cloneNode(!0)]:[]},q.doc=function(){var a=this.viewport();return{width:Math.max(t.body.scrollWidth,u.scrollWidth,a.width),height:Math.max(t.body.scrollHeight,u.scrollHeight,a.height)}},q.firstChild=function(a){for(var b,c=a.childNodes,d=0,e=c&&c.length||0;e>d;d++)1===c[d].nodeType&&(b=c[e=d]);return b},q.viewport=function(){return{width:C?u.clientWidth:self.innerWidth,height:C?u.clientHeight:self.innerHeight}},q.isAncestor="compareDocumentPosition"in u?function(a,b){return 16==(16&a.compareDocumentPosition(b))}:"contains"in u?function(a,b){return a!==b&&a.contains(b)}:function(a,b){for(;b=b[v];)if(b===a)return!0;return!1};var O=r.bonzo;return q.noConflict=function(){return r.bonzo=O,this},q});var envision={_:Flotr._,bean:Flotr.bean,bonzo:bonzo,noConflict:function(a){var b=a.envision;return function(){return a.envision=b,this}}(this)};!function(){function a(a){this.options=a||{},this.components=[],this.node=null,this.rendered=!1}var b="envision-first",c="envision-last",d='<div class="envision-visualization"></div>';T_COMPONENT_CONTAINER='<div class="envision-component-container"></div>',a.prototype={render:function(a){var b=this.options;if(a=a||b.element,!a)throw"No element to render within.";return this.node=bonzo.create(d)[0],bonzo(this.node).addClass(b.name||""),this.container=a,bonzo(a).append(this.node),bonzo(a).data("envision",this),_.each(this.components,function(a){this._renderComponent(a)},this),this._updateClasses(),this.rendered=!0,this},add:function(a){return this.components.push(a),this.rendered&&(this._renderComponent(a),this._updateClasses()),this},remove:function(a){var b=this.components,c=this.indexOf(a);return-1!==c&&(b.splice(c,1),bonzo(a.container).remove(),this._updateClasses()),this},setPosition:function(a,b){var c=this.components;return b>=0&&b<c.length&&this.remove(a)&&(this.rendered&&(b===c.length?this.node.appendChild(a.container):this.node.insertBefore(a.container,c[b].container)),c.splice(b,0,a),this._updateClasses()),this},indexOf:function(a){return _.indexOf(this.components,a)},getComponent:function(a){var b=this.components;return a<b.length?b[a]:void 0},isFirst:function(a){return 0===this.indexOf(a)?!0:!1},isLast:function(a){return this.indexOf(a)===this.components.length-1?!0:!1},destroy:function(){_.each(this.components,function(a){a.destroy()}),bonzo(this.container).empty()},_renderComponent:function(a){var b=bonzo.create(T_COMPONENT_CONTAINER)[0];bonzo(this.node).append(b),a.render(b)},_updateClasses:function(){var a,d=this.components,e=0,f=d.length-1;_.each(d,function(d,g){a=bonzo(d.container),g===e?a.addClass(b):a.removeClass(b),g===f?a.addClass(c):a.removeClass(c)})}},envision.Visualization=a}(),function(){function a(a){a=a||{};var c=bonzo.create(d)[0];this.options=a,this.node=c,a.adapter?this.api=a.adapter:a.adapterConstructor?this.api=new a.adapterConstructor(a.config):a.adapterCallback?this.api=a.adapterCallback.call(null,a.config):a.config&&(this.api=new b.adapters.flotr.Child(a.config||{})),this.preprocessors=[]}var b=envision,c="envision-component",d='<div class="'+c+'"></div>';a.prototype={render:function(a){var b=(this.node,this.options);if(a=a||b.element,!a)throw"No element to render within.";bonzo(a).addClass(b.name||"").append(this.node),this._setDimension("width"),this._setDimension("height"),this.container=a,this.draw(b.data,b.config)},draw:function(a,c){var d,e=this.api,f=this.options,g=this.preprocessors;d=a=a||f.data,c=c||f.config,!f.skipPreprocess&&a&&(d=[],_.each(e.getDataArray(a),function(h,i){var j,k,l=g[i]||new b.Preprocessor,m=_.isArray(h),n=_.isFunction(h),o=(m?h:n?h:h.data,f.processData),p=e.range(c),q=p.min,r=p.max,s=this.node.clientWidth,t=h;n||m||(t=h.data,k=_.extend({},h)),n?j=a(q,r,s):(t!==l.data?l.setData(t):l.reset(),o?(o.apply(this,[{preprocessor:l,min:q,max:r,resolution:s}]),j=l.getData()):j=l.bound(q,r).subsampleMinMax(s).getData()),e.transformData&&(j=e.transformData(j)),k?(k.data=j,d.push(k)):d.push(j)},this)),e&&e.draw(d,c,this.node)},trigger:function(){this.api.trigger.apply(this.api,Array.prototype.concat.apply([this],arguments))},attach:function(){this.api.attach.apply(this.api,Array.prototype.concat.apply([this],arguments))},detach:function(){this.api.detach.apply(this.api,Array.prototype.concat.apply([this],arguments))},destroy:function(){this.api&&this.api.destroy&&this.api.destroy(),bonzo(this.container).empty()},_setDimension:function(a){var b=this.node,c=this.options;c[a]?bonzo(b).css(a,c[a]):c[a]=b.clientWidth,this[a]=c[a]}},b.Component=a}(),function(){function a(a){this.options=a=a||{},this.actions=[],this.actionOptions=[],this.followers=[],this.leaders=[],this.prevent={},a.leader&&this.leader(a.leader)}var b=envision;a.prototype={leader:function(a){return this.leaders.push(a),_.each(this.actions,function(b,c){this._bindLeader(a,b,this.actionOptions[c])},this),this},follower:function(a){return this.followers.push(a),this},group:function(a){return _.isArray(a)||(a=[a]),_.each(a,function(a){this.leader(a),this.follower(a)},this),this},add:function(a,b){return this.actions.push(a),this.actionOptions.push(b),_.each(this.leaders,function(c){this._bindLeader(c,a,b)},this),this},_bindLeader:function(a,b,c){_.each(b.events,function(b){var d=b.handler||b,e=b.consumer||b;a.attach(d,_.bind(function(a,b){if(!this.prevent[name]){c&&c.callback&&c.callback.call(this,b),this.prevent[name]=!0;try{_.each(this.followers,function(c){a!==c&&c.trigger(e,b)},this)}catch(d){throw this.prevent[name]=!1,d}this.prevent[name]=!1}},this))},this)}},b.Interaction=a}(),function(){function a(a){a=a||{},this.getData=function(){return this.bounded&&d(this),this.processing},this.reset=function(){return this.processing=this.data,this},this.setData=function(a){var b,c;if(!_.isArray(a))throw new Error("Array expected.");if(a.length<2)throw new Error("Data must contain at least two dimensions.");for(c=a[0].length,b=a.length;b--;){if(!_.isArray(a[b]))throw new Error("Data dimensions must be arrays.");if(a[b].length!==c)throw new Error("Data dimensions must contain the same number of points.")}return this.processing=a,this.data=a,this},a.data&&this.setData(a.data)}function b(a,b){var c=_.sortedIndex(a,b);return a[c]>b&&c>0&&c--,c}function c(a,b){return _.sortedIndex(a,b)}function d(a){delete a.bounded;var d=a.processing,e=a.length(),f=d[0],g=d[1],h=a.min||0,i=a.max||e,j=b(f,h),k=c(f,i);a.processing=[f.slice(j,k+1),g.slice(j,k+1)],a.start=j,a.end=k}function e(a,b,c,d,e,f,g,h,i){var j=(a-d)/(f-d),k=1-j,l=(1+2*j)*k*k,m=j*k*k,n=j*j*(3-2*j),o=j*j*(j-1),p=(g-e)/(2*(f-d))+("undefined"==typeof c?0:(e-c)/(2*(d-b))),q=("undefined"==typeof i?0:(i-g)/(2*(h-f)))+(g-e)/(2*(f-d)),r=l*e+m*(f-d)*p+n*g+o*(f-d)*q;return r}a.prototype={length:function(){return this.getData()[0].length},bound:function(a,b){return _.isNumber(a)&&_.isNumber(b)?(this.min=a,this.max=b,this.bounded=!0,this):this},subsampleMinMax:function(a){var d=this.bounded;delete this.bounded;var e,f,g,h=this.processing,i=this.length(),j=h[0],k=h[1],l=d?b(j,this.min):0,m=d?c(j,this.max):i-1,n=(a-2)/2,o=[],p=[],q=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=1,t=1,u=(m-l)/n;if(m-l+1>a){for(o.push(j[l]),p.push(k[l]),e=l+u,f=l;m>f;f++)f===Math.round(e)?(e+=u,g=Math.min(t,s),o.push(j[g]),p.push(k[g]),g=Math.max(t,s),o.push(j[g]),p.push(k[g]),s=f,q=k[s],t=f,r=k[t]):(k[f]>r&&(r=k[f],t=f),k[f]<q&&(q=k[f],s=f));e>f&&(o.push(j[s]),p.push(q),o.push(j[t]),p.push(r)),o.push(j[m]),p.push(k[m]),this.processing=[o,p],this.start=l,this.end=m}else this.bounded=d;return this},subsample:function(a){var d=this.bounded;delete this.bounded;var e,f,g=this.processing,h=this.length(),i=g[0],j=g[1],k=d?b(i,this.min):0,l=d?c(i,this.max):h-1,m=(l-k+1)/a,n=[],o=[];if(l-k+1>a){for(n.push(i[k]),o.push(j[k]),e=1;a>e&&!(e*m>=l-m);e++)f=Math.round(e*m)+k,n.push(i[f]),o.push(j[f]);n.push(i[l]),o.push(j[l]),this.processing=[n,o],this.start=k,this.end=l}else this.bounded=d;return this},interpolate:function(a){var d=this.bounded;delete this.bounded;var f,g,h,i=this.processing,j=this.length(),k=i[0],l=i[1],m=d?b(k,this.min):0,n=d?c(k,this.max):j-1,o=(k[n]-k[m])/a,p=[],q=[];if(p.push(k[m]),q.push(l[m]),a>n-m+1){for(f=m;n>f;f++)for(h=k[f+1]-k[f],p.push(k[f]),q.push(l[f]),g=k[f+0]+o;g<k[f+1];g+=o)p.push(g),q.push(e(g,k[f-1],l[f-1],k[f+0],l[f+0],k[f+1],l[f+1],k[f+2],l[f+2]));this.processing=[p,q],this.start=m,this.end=n}return this}},envision.Preprocessor=a}(),envision.actions=envision.actions||{},envision.actions.hit={events:["hit","mouseout"]},envision.actions.selection={events:[{handler:"select",consumer:"zoom"},{handler:"click",consumer:"reset"}]},envision.actions.zoom={events:[{handler:"select",consumer:"zoom"},"zoom","reset"]},envision.adapters=envision.adapters||{},envision.adapters.flotr={},envision.adapters.defaultOptions={grid:{outlineWidth:0,labelMargin:0,horizontalLines:!1,verticalLines:!1},bars:{show:!1,barWidth:.5,fill:!0,lineWidth:1,fillOpacity:1},lines:{lineWidth:1},xaxis:{margin:!1,tickDecimals:0,showLabels:!1},yaxis:{margin:!1,showLabels:!1},shadowSize:!1},function(){function a(a){this.options=a||{},this.flotr=null,this._flotrDefaultOptions()}function b(a,b){var c,d,e,f,g,h=a.options.config.selection.mode,i=a.api.flotr.axes;return-1!==h.indexOf("x")&&(c={},c.min=b.x1,c.max=b.x2,e={},e.min=i.x.d2p(b.x1),e.max=i.x.d2p(b.x2)),-1!==h.indexOf("y")&&(d={},d.min=b.y1,d.max=b.y2,f={},f.min=i.y.d2p(b.y1),f.max=i.y.d2p(b.y2)),g={data:{x:c,y:d},x:e,y:f}}var c=envision.adapters,d=Flotr.EventAdapter,e=c.defaultOptions;a.prototype={destroy:function(){this.flotr.destroy()},draw:function(a,b,c){var d=this.options;if(a=this.getDataArray(a||d.data),b=b?Flotr.merge(b,Flotr.clone(d)):d,d.data=a,!b)throw"No graph submitted.";this.flotr=Flotr.draw(c,a,b)},range:function(a){var b=a.xaxis;return{min:b.min,max:b.max}},transformData:function(a){var b,c,d,e=a[0].length,f=a.length,g=[];for(c=0;e>c;c++){for(b=[],d=0;f>d;d++)b.push(a[d][c]);g.push(b)}return g},getDataArray:function(a){return a[0]&&(!_.isArray(a[0])||!a[0].length||a[0][0]&&_.isArray(a[0][0]))?a:[a]},_flotrDefaultOptions:function(a){var b,c=a||this.options;for(b in e)e.hasOwnProperty(b)&&(_.isUndefined(c[b])?c[b]=e[b]:_.defaults(c[b],e[b]))},attach:function(a,b,c){var e=this.events[b]||{},f=e.handler||!1;return b=e.name||!1,f?d.observe(a.node,b,function(){var b=[a].concat(Array.prototype.slice.call(arguments)),d=f.apply(this,b);return c.apply(null,[a,d])}):!1},detach:function(a,b){return d.stopObserve(a.node,b,handler)},trigger:function(a,b,c){var d=this.events[b],e=d.consumer||!1;return e?e.apply(this,[a,c]):!1},events:{hit:{name:"flotr:hit",handler:function(a,b){var c,d=b.x,e=b.y,f=a.api.flotr;return c={data:{index:b.index,x:d,y:e},x:f.axes.x.d2p(d),y:f.axes.y.d2p(e)}},consumer:function(a,b){var c,d=a.api.flotr;c={x:b.data.x,y:b.data.y||1,relX:b.x,relY:b.y||1},d.hit.hit(c)}},select:{name:"flotr:selecting",handler:b,consumer:function(a,b){var c=a.api.flotr,d=c.axes,e=b.data||{},f={},g=b.x,h=b.y;!g&&e.x?(g=e.x,f.x1=g.min,f.x2=g.max):g&&(f.x1=d.x.p2d(g.min),f.x2=d.x.p2d(g.max)),!h&&e.y?(h=e.y,f.y1=h.min,f.y2=h.max):h&&(f.y1=d.y.d2p(h.min),f.y2=d.y.d2p(h.max)),c.selection.setSelection(f)}},zoom:{name:"flotr:select",handler:function(a,c){var d=b(a,c);return a.trigger("zoom",d),d},consumer:function(a,b){var c=b.data.x,d=b.data.y,e={};c&&(e.xaxis={min:c.min,max:c.max}),d&&(e.yaxis={min:d.min,max:d.max}),a.draw(null,e)}},mouseout:{name:"flotr:mouseout",handler:function(){},consumer:function(a){a.api.flotr.hit.clearHit()}},reset:{name:"flotr:click",handler:function(a){a.draw()},consumer:function(a){a.draw()}},click:{name:"flotr:click",handler:function(a){var b=a.api.flotr.axes.x.min,c=a.api.flotr.axes.x.max;return{data:{x:{min:b,max:c}},x:{min:a.api.flotr.axes.x.d2p(b),max:a.api.flotr.axes.x.d2p(c)}}},consumer:function(a,b){var c=b.data.x,d=b.data.y,e={};c&&(e.xaxis={min:c.min,max:c.max}),d&&(e.yaxis={min:d.min,max:d.max}),a.draw(null,e)}}}},c.flotr.Child=a}(),Flotr.addType("lite-lines",{options:{show:!1,lineWidth:2,fill:!1,fillBorder:!1,fillColor:null,fillOpacity:.4},draw:function(a){{var b=a.context,c=a.lineWidth;a.shadowSize}b.save(),b.lineCap="butt",b.lineWidth=c,b.strokeStyle=a.color,this.plot(a),b.restore()},plot:function(a){var b,c,d=a.context,e=a.xScale,f=a.yScale,g=a.data,h=g.length-1,j=f(0);if(!(1>h)){for(b=e(g[0][0]),c=f(g[0][1]),d.beginPath(),d.moveTo(b,c),i=0;i<h;++i)d.lineTo(e(g[i+1][0]),f(g[i+1][1]));(!a.fill||a.fill&&!a.fillBorder)&&d.stroke(),a.fill&&(b=e(g[0][0]),d.fillStyle=a.fillStyle,d.lineTo(e(g[h][0]),j),d.lineTo(b,j),d.lineTo(b,f(g[0][1])),d.fill(),a.fillBorder&&d.stroke())}},extendYRange:function(a,b,c){var d=a.options;(!d.max&&0!==d.max||!d.min&&0!==d.min)&&(a.max+=.01*c.lineWidth,a.min-=.01*c.lineWidth)}}),Flotr.addType("whiskers",{options:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,fillOpacity:.4,horizontal:!1,stacked:!1,centered:!0},stack:{positive:[],negative:[],_positive:[],_negative:[]},draw:function(a){var b=a.context;b.save(),b.lineJoin="miter",b.lineCap="butt",b.lineWidth=a.lineWidth,b.strokeStyle=a.color,a.fill&&(b.fillStyle=a.fillStyle),this.plot(a),b.restore()},plot:function(a){var b,c,d=a.data,e=a.context,f=(a.shadowSize,a.xScale),g=a.yScale,h=g(0);if(!(d.length<1)){for(e.translate(-a.lineWidth,0),e.beginPath(),b=0;b<d.length;b++)c=f(d[b][0]),e.moveTo(c,h),e.lineTo(c,g(d[b][1]));e.closePath(),e.stroke()}},drawHit:function(a){var b=a.args,c=a.context,d=(a.shadowSize,a.xScale),e=a.yScale,f=e(0),g=d(b.x),h=e(b.y);c.save(),c.translate(-a.lineWidth,0),c.beginPath(),c.moveTo(g,f),c.lineTo(g,h),c.closePath(),c.stroke(),c.restore()},clearHit:function(a){var b=a.args,c=a.context,d=(a.shadowSize,a.xScale),e=a.yScale,f=a.lineWidth,g=e(0),h=d(b.x),i=e(b.y);c.save(),c.clearRect(h-2*f,i-f,4*f,g-i+f),c.restore()}}),envision.components=envision.components||{},function(){function a(a){this.options=a||{}}a.prototype={height:null,width:null,rendered:!1,render:function(a){var b=document.createElement("canvas"),c=bonzo(a).offset();this.height=c.height,this.width=c.width,bonzo(b).attr("height",c.height).attr("width",c.width).css({position:"absolute",top:"0px",left:"0px"}),a.appendChild(b),bonzo(a).css({position:"relative"}),"undefined"!=typeof FlashCanvas&&FlashCanvas.initElement(b),this.context=b.getContext("2d"),this.rendered=!0},draw:function(a,b,c){this.rendered||this.render(c);var d,e,f=this.context,g=this.height,h=this.width,i=Math.round(g/2)-.5;b=b||{min:h/2,max:h/2},d=b.min+.5,e=b.max+.5,f.clearRect(0,0,h,g),(d||e)&&(f.save(),f.strokeStyle=this.options.strokeStyle||"#B6D9FF",f.fillStyle=this.options.fillStyle||"rgba(182, 217, 255, .4)",f.beginPath(),1>=d?(f.moveTo(0,g),f.lineTo(0,-.5)):(f.moveTo(d,g),f.quadraticCurveTo(d,i,Math.max(d-i,d/2),i),f.lineTo(Math.min(i,d/2),i),f.quadraticCurveTo(0,i,.5,-.5)),f.lineTo(h-.5,-.5),e>=h-1?f.lineTo(e,g):(f.quadraticCurveTo(h,i,Math.max(h-i,h-(h-e)/2),i),f.lineTo(Math.min(e+i,h-(h-e)/2),i),f.quadraticCurveTo(e,i,e,g)),f.stroke(),f.closePath(),f.fill(),f.restore())},trigger:function(a,b,c){"zoom"===b?this.zoom(a,c):"reset"===b&&this.reset(a)},zoom:function(a,b){{var c=b.x||{},d=c.min,e=c.max;a.api}a.draw(null,{min:d,max:e})},reset:function(a){a.draw(null,{min:a.width/2,max:a.width/2})}},envision.components.QuadraticDrawing=a}(),envision.templates=envision.templates||{},function(){function a(a){var b=a.resolution;a.preprocessor.bound(a.min,a.max).subsampleMinMax(b+Math.round(b/3))}function b(){return{price:{name:"envision-finance-price",config:{"lite-lines":{lineWidth:1,show:!0,fill:!0,fillOpacity:.2},mouse:{track:!0,trackY:!1,trackAll:!0,sensibility:1,trackDecimals:4,position:"ne"},yaxis:{autoscale:!0,autoscaleMargin:.05,noTicks:4,showLabels:!0,min:0}},processData:a},volume:{name:"envision-finance-volume",config:{whiskers:{show:!1,lineWidth:2},mouse:{track:!1,trackY:!1,trackAll:!1},yaxis:{autoscale:!0,autoscaleMargin:.5}},processData:a},summary:{name:"envision-finance-summary",config:{"lite-lines":{show:!0,lineWidth:1,fill:!0,fillOpacity:.2,fillBorder:!0},xaxis:{noTicks:5,showLabels:!0},yaxis:{autoscale:!0,autoscaleMargin:.1},handles:{show:!0},selection:{mode:"x"},grid:{verticalLines:!1}}},connection:{name:"envision-finance-connection",adapterConstructor:d.components.QuadraticDrawing}}}function c(a){var c,e,f,g,h=a.data,i=b(),j=new d.Visualization({name:"envision-finance"}),k=new d.Interaction,l=new d.Interaction;a.defaults&&(i=Flotr.merge(a.defaults,i)),i.price.data=h.price,i.volume.data=h.volume,i.summary.data=h.summary,i.price.config.mouse.trackFormatter=a.trackFormatter||function(a){var b,d=a.index;return c.api.preprocessor&&(d+=c.api.preprocessor.start),b="Price: $"+h.price[1][d]},a.xTickFormatter&&(i.summary.config.xaxis.tickFormatter=a.xTickFormatter),i.price.config.yaxis.tickFormatter=a.yTickFormatter||function(a){return"$"+a},c=new d.Component(i.price),e=new d.Component(i.volume),f=new d.Component(i.connection),g=new d.Component(i.summary),j.add(c).add(e).add(f).add(g).render(a.container),k.follower(c).follower(e).follower(f).leader(g).add(d.actions.selection,a.selectionCallback?{callback:a.selectionCallback}:null),l.group([c,e]).add(d.actions.hit),a.selection&&g.trigger("select",a.selection),this.vis=j,this.selection=k,this.hit=l,this.price=c,this.volume=e,this.summary=g}var d=envision;d.templates.Finance=c}(),function(){function a(){return{detail:{name:"envision-timeseries-detail",config:{"lite-lines":{lineWidth:1,show:!0}}},summary:{name:"envision-timeseries-summary",config:{"lite-lines":{lineWidth:1,show:!0},handles:{show:!0},selection:{mode:"x"},yaxis:{autoscale:!0,autoscaleMargin:.1}}},connection:{name:"envision-timeseries-connection",adapterConstructor:c.components.QuadraticDrawing}}}function b(b){var d,e,f,g=b.data,h=a(),i=new c.Visualization({name:"envision-timeseries"}),j=new c.Interaction;b.defaults&&(h=Flotr.merge(b.defaults,h)),h.detail.data=g.detail,h.summary.data=g.summary,d=new c.Component(h.detail),f=new c.Component(h.connection),e=new c.Component(h.summary),i.add(d).add(f).add(e).render(b.container),j.follower(d).follower(f).leader(e).add(c.actions.selection,b.selectionCallback?{callback:b.selectionCallback}:null),b.selection&&e.trigger("select",b.selection),this.vis=i,this.selection=j,this.detail=d,this.summary=e}var c=envision;c.templates.TimeSeries=b}(),function(){function a(){return{name:"zoom"}}function b(){return{name:"summary",config:{handles:{show:!0},selection:{mode:"x"}}}}function c(a,b){var c=_.defaults(a,b);return c.flotr=_.defaults(c.flotr,b.flotr),c}var d,e=envision;d=function(d){var f=new e.Visualization,g=new e.Component(c(d.zoom||{},a())),h=new e.Component(c(d.summary||{},b())),i=new e.Interaction({leader:h});f.add(g).add(h),i.add(e.actions.selection),i.follower(g),this.vis=f,this.interaction=i,d.container&&this.render(d.container)},d.prototype={render:function(a){this.vis.render(a)}},e.templates.Zoom=d}(),L.CanvasOverlay=L.Class.extend({initialize:function(a,b){this._userDrawFunc=a,L.setOptions(this,b)},drawing:function(a){return this._userDrawFunc=a,this},params:function(a){return L.setOptions(this,a),this},canvas:function(){return this._canvas},redraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(a){this._map=a,this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer");var b=this._map.getSize();this._canvas.width=b.x,this._canvas.height=b.y;var c=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(c?"animated":"hide")),a._panes.overlayPane.appendChild(this._canvas),a.on("moveend",this._reset,this),a.on("resize",this._resize,this),a.options.zoomAnimation&&L.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._canvas),a.off("moveend",this._reset,this),a.off("resize",this._resize,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this),this_canvas=null},addTo:function(a){return a.addLayer(this),this},_resize:function(a){this._canvas.width=a.newSize.x,this._canvas.height=a.newSize.y},_reset:function(){var a=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,a),this._redraw()},_redraw:function(){var a=this._map.getSize(),b=this._map.getBounds(),c=180*a.x/(20037508.34*(b.getEast()-b.getWest())),d=this._map.getZoom();this._userDrawFunc&&this._userDrawFunc(this,{canvas:this._canvas,bounds:b,size:a,zoomScale:c,zoom:d,options:this.options}),this._frame=null},_animateZoom:function(a){var b=this._map.getZoomScale(a.zoom),c=this._map._getCenterOffset(a.center)._multiplyBy(-b).subtract(this._map._getMapPanePos());
this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(c)+" scale("+b+")"}}),L.canvasOverlay=function(a,b){return new L.CanvasOverlay(a,b)};var C_WMIN=-180,C_WMAX=180,C_HMIN=-90,C_HMAX=90,C_W=C_WMAX-C_WMIN,C_H=C_HMAX-C_HMIN,M_ZOOM_RANGE=[1,12],M_BASE_GRIDROWS=300,M_BUBBLE_OFFSET=20,M_HOVER_OFFSET={l:8,t:8},M_DEFAULT_TILE_OPACITY=1,M_DEFAULT_TILE_CONF=3;M_COLOR_SCALE=["#ccddff","#aacc66","#aa6611","#800","#300"];var CALC_TIMEOUT=200,T_DEFAULT_TOOLTIP="%l in %x: %v",T_DEFAULT_ZPROP="#",L_DEFAULT_TERM="between %l and %h",DATA_DIR="./data/",META_FILES=["humans.json","items.json"],DEFAULT_DATAGROUP="humans",DEFAULT_DATASET=0,DEFAULT_LABELLANG="en",ARR_M_LON=0,ARR_M_LAT=1,ARR_M_I=2,TPI=2*Math.PI,chart,summary,leafly,$bubble,allow_redraw=!0,timelineIsGlobal=1,colorScale,mutexGenGrid=0,initComplete=!1,redrawTimer,chartdatTimer,bubbleTimer,resizeTimer,infolistTimer,gdata=[],current_datsel,current_setsel={},chartdat=[],timeSel,cellmap,drawdat={},selectedCell=!1,renderRTL=!1,resoFactor,viewportH,viewportW,leafloor,leaflaggrid,overcan,overctx,canvasW,canvasH,lastMapCenter,lastMapZoom,lastAgPos=[0,0],langCodes=["aa","ab","ace","aeb","af","ak","aln","als","am","an","ang","anp","ar","arc","arn","arq","ary","arz","as","ast","av","avk","ay","az","azb","ba","bar","bbc","bbc-latn","bcc","bcl","be","be-tarask","be-x-old","bg","bh","bho","bi","bjn","bm","bn","bo","bpy","bqi","br","brh","bs","bug","bxr","ca","cbk-zam","cdo","ce","ceb","ch","cho","chr","chy","ckb","co","cps","cr","crh-cyrl","crh-latn","cs","csb","cu","cv","cy","da","de","de-at","de-ch","de-formal","diq","dsb","dtp","dv","dz","ee","egl","el","eml","en","en-ca","en-gb","eo","es","et","eu","ext","fa","ff","fi","fit","fiu-vro","fj","fo","fr","frc","frp","frr","fur","fy","ga","gag","gan","gan-hans","gan-hant","gd","gl","glk","gn","gom-latn","got","grc","gsw","gu","gv","ha","hak","haw","he","hi","hif","hif-latn","hil","ho","hr","hrx","hsb","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","ike-cans","ike-latn","ilo","inh","io","is","it","iu","ja","jam","jbo","jut","jv","ka","kaa","kab","kbd","kbd-cyrl","kg","khw","ki","kiu","kj","kk","kk-arab","kk-cn","kk-cyrl","kk-kz","kk-latn","kk-tr","kl","km","kn","ko","ko-kp","koi","kr","krc","kri","krj","ks","ks-arab","ks-deva","ksh","ku","ku-arab","ku-latn","kv","kw","ky","la","lad","lb","lbe","lez","lfn","lg","li","lij","liv","lmo","ln","lo","loz","lrc","lt","ltg","lus","lv","lzh","lzz","mai","map-bms","mdf","mg","mh","mhr","mi","min","mk","ml","mn","mo","mr","mrj","ms","mt","mus","mwl","my","myv","mzn","na","nah","nan","nap","nb","nds","nds-nl","ne","new","ng","niu","nl","nl-informal","nn","no","nov","nrm","nso","nv","ny","oc","om","or","os","ota","pa","pag","pam","pap","pcd","pdc","pdt","pfl","pi","pih","pl","pms","pnb","pnt","prg","ps","pt","pt-br","qu","qug","rgn","rif","rm","rmy","rn","ro","roa-tara","ru","rue","rup","ruq","ruq-cyrl","ruq-latn","rw","rwr","sa","sah","sat","sc","scn","sco","sd","sdc","se","sei","sg","sgs","sh","shi","shi-latn","shi-tfng","si","simple","sk","sl","sli","sm","sma","sn","so","sq","sr","sr-ec","sr-el","srn","ss","st","stq","su","sv","sw","szl","ta","tcy","te","tet","tg","tg-cyrl","tg-latn","th","ti","tk","tl","tly","tn","to","tokipona","tpi","tr","tru","ts","tt","tt-cyrl","tt-latn","tum","tw","ty","tyv","udm","ug","ug-arab","ug-latn","uk","ur","uz","ve","vec","vep","vi","vls","vmf","vo","vot","vro","wa","war","wo","wuu","xal","xh","xmf","yi","yo","yue","za","zea","zh","zh-cn","zh-hans","zh-hant","zh-hk","zh-min-nan","zh-mo","zh-my","zh-sg","zh-tw","zu"];$(function(){lastMapCenter={lat:0,lng:0},resoFactor=parseFloat($("#reso-slider").val()),$bubble=$("#bubble"),overcan=d3.select("#map").append("canvas").classed("overlay",!0),overctx=overcan.node().getContext("2d"),colorScale=d3.scale.log().range(M_COLOR_SCALE);var a=new Date;console.log("~~ started loading the meta files (total of "+META_FILES.length+") ~~ ");for(var b=function(b){for(var d=0;d<b.datasets.length;d++)b.datasets[d].parent=b;gdata[c++]=b,c===META_FILES.length&&(console.log(" |BM| got all the meta files (took "+(new Date-a)+"ms)"),setupControlHandlers(),onResize(),statifyUrl())},c=0,d=0;d<META_FILES.length;d++)$.getJSON(DATA_DIR+META_FILES[d],b)});